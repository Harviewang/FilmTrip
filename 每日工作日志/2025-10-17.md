# 每日工作日志 · 2025-10-17

## 对话简述
- **目标**：修复预览模式（标准/沉浸）展示、瀑布流布局、旋转与动画体验。
- **过程**：多轮调试与实测，确认最终需求：
  - 列表页瀑布流采用“固定列宽 + 最小累计高度列（最小堆）”策略；不做前端旋转判断。
  - 预览标准模式：图片长边≈显示区域 80%，EXIF 固定底部，不与图片重叠。
  - 预览沉浸模式：全屏 contain，水平/垂直居中，隐藏 EXIF 和工具栏；标准模式显示工具栏（左旋/右旋/分享/复制/关闭）。

## 历史人物（本日参与者）
- **用户**：harvie（产品/验收）
- **协作**：Cascade（实现与自测）

## 新增任务
- **瀑布流最小堆实现**：固定列宽与间距、维护 K 列累计高度、分页续算。
- **预览工具栏显隐策略**：标准模式显示四个按钮，沉浸模式隐藏。
- **后端方向统一**：上传阶段完成方向校正并返回规范化宽高（用户后续提供逻辑）。

## 任务完成情况
- **已完成**
  - `PhotoPreview.jsx`：
    - 标准模式：图片长边≈80%，`object-fit: contain`；EXIF 固定底部，永不重叠。
    - 沉浸模式：全屏 contain，居中；隐藏 EXIF。
    - 动画：旋转/切换统一为 `ease-in-out`，时长优化，去回弹甩动。
  - `Photos/index.jsx`：
    - 过渡方案：使用图片实际 `offsetHeight` 估算高度，临时改善“一行”问题。
- **进行中**
  - 瀑布流“最小累计高度列（最小堆）”内核与断点策略。
  - 预览工具栏显示/隐藏与按钮逻辑细节。

## 遗留事项 / 待解决问题
- **瀑布流最小堆**：
  - 需替换现有 row-span/估算逻辑为“固定列宽 + 绝对定位 + K 列累计高度”放置。
  - 自适应断点列数与固定间距，分页加载延续累计高度。
- **预览工具栏**：
  - 仅在标准模式显示左旋/右旋/分享/复制链接/关闭；沉浸模式隐藏。
- **后端方向校正**：
  - 上传阶段完成 EXIF 方向归一化，前端不再判断。

## 代码改动点（今日）
- `frontend/src/components/PhotoPreview.jsx`
  - EXIF 由相对布局改为**底部绝对定位**，确保不与图片重叠。
  - 标准模式容器：`maxWidth: 95vw`, `maxHeight: 80vh`，图片 `object-fit: contain`。
  - 沉浸模式：`maxWidth/maxHeight: 100vw/100vh`，`object-fit: contain`，隐藏 EXIF 与工具栏。
  - 动画：统一 `transition … ease-in-out`，旋转/切换更顺滑。
- `frontend/src/pages/Photos/index.jsx`
  - 临时改善瀑布流：基于图片渲染后的 `offsetHeight` 计算 span，并加间距缓冲。
  - 后续将替换为“最小堆”实现。

## 明日计划
- 完成**瀑布流最小堆**核心与响应式列数/固定间距。
- 完成**预览工具栏显隐**逻辑与按钮行为。
- 验收与细节抛光。

---
分支：`feature/masonry-and-preview`
提交：`chore(preview,masonry): standard 80% + immersive contain; bottom EXIF; prep masonry core`
