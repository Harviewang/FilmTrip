<!DOCTYPE html>
<html>
<head>
    <title>检查照片尺寸</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .test-container { margin: 20px 0; padding: 10px; border: 2px solid #ccc; }
        img { display: block; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>照片尺寸检查</h1>
    
    <div class="test-container">
        <h2>照片 #11 (1200×1800)</h2>
        <div id="photo11-info"></div>
        <img id="photo11" src="http://localhost:3001/uploads/164fbfa4-6f31-4633-aa68-cd15242f76ba_011.JPG" />
    </div>
    
    <div class="test-container">
        <h2>照片 #12 (1800×1200)</h2>
        <div id="photo12-info"></div>
        <img id="photo12" src="http://localhost:3001/uploads/00d89a18-62ea-458f-b15d-96fea70116bc_012.JPG" />
    </div>
    
    <div class="test-container">
        <h2>照片 #12 旋转 90°</h2>
        <div id="photo12-rotated-info"></div>
        <img id="photo12-rotated" src="http://localhost:3001/uploads/00d89a18-62ea-458f-b15d-96fea70116bc_012.JPG" style="transform: rotate(90deg);" />
    </div>

    <script>
        // 模拟 getFittedSizeAfterRotate 函数
        function getFittedSizeAfterRotate(imgWidth, imgHeight, rotateDeg) {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const MAX_W_RATIO = 0.8;
            const MAX_H_RATIO = 0.8;
            
            const norm = ((rotateDeg % 360) + 360) % 360;
            const swapped = norm === 90 || norm === 270;
            
            const rw = swapped ? imgHeight : imgWidth;
            const rh = swapped ? imgWidth : imgHeight;
            
            const maxW = vw * MAX_W_RATIO;
            const maxH = vh * MAX_H_RATIO;
            
            const scaleByWidth = maxW / rw;
            const scaleByHeight = maxH / rh;
            const scale = Math.min(scaleByWidth, scaleByHeight);
            
            const width = rw * scale;
            const height = rh * scale;
            
            return {
                width: Math.floor(width),
                height: Math.floor(height),
                scale: scale.toFixed(3),
                rw, rh
            };
        }
        
        window.addEventListener('load', function() {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            
            document.getElementById('photo11-info').innerHTML = `
                <p><strong>视口:</strong> ${vw} × ${vh}</p>
                <p><strong>80% 限制:</strong> ${Math.floor(vw*0.8)} × ${Math.floor(vh*0.8)}</p>
                <p><strong>原始尺寸:</strong> 1200 × 1800</p>
                <p><strong>旋转角度:</strong> 0°</p>
                ${JSON.stringify(getFittedSizeAfterRotate(1200, 1800, 0), null, 2).replace(/\n/g, '<br>').replace(/ /g, '&nbsp;')}
            `;
            
            document.getElementById('photo12-info').innerHTML = `
                <p><strong>视口:</strong> ${vw} × ${vh}</p>
                <p><strong>80% 限制:</strong> ${Math.floor(vw*0.8)} × ${Math.floor(vh*0.8)}</p>
                <p><strong>原始尺寸:</strong> 1800 × 1200</p>
                <p><strong>旋转角度:</strong> 0°</p>
                ${JSON.stringify(getFittedSizeAfterRotate(1800, 1200, 0), null, 2).replace(/\n/g, '<br>').replace(/ /g, '&nbsp;')}
            `;
            
            document.getElementById('photo12-rotated-info').innerHTML = `
                <p><strong>视口:</strong> ${vw} × ${vh}</p>
                <p><strong>80% 限制:</strong> ${Math.floor(vw*0.8)} × ${Math.floor(vh*0.8)}</p>
                <p><strong>原始尺寸:</strong> 1800 × 1200</p>
                <p><strong>旋转角度:</strong> 90°</p>
                ${JSON.stringify(getFittedSizeAfterRotate(1800, 1200, 90), null, 2).replace(/\n/g, '<br>').replace(/ /g, '&nbsp;')}
            `;
            
            // 应用计算出的尺寸
            const size11 = getFittedSizeAfterRotate(1200, 1800, 0);
            document.getElementById('photo11').style.width = size11.width + 'px';
            document.getElementById('photo11').style.height = size11.height + 'px';
            
            const size12 = getFittedSizeAfterRotate(1800, 1200, 0);
            document.getElementById('photo12').style.width = size12.width + 'px';
            document.getElementById('photo12').style.height = size12.height + 'px';
            
            const size12rotated = getFittedSizeAfterRotate(1800, 1200, 90);
            document.getElementById('photo12-rotated').style.width = size12rotated.width + 'px';
            document.getElementById('photo12-rotated').style.height = size12rotated.height + 'px';
        });
    </script>
</body>
</html>

