# å›¾ç‰‡æ—‹è½¬å®ç°æœ€ä½³å®è·µä¸é—®é¢˜å¤ç›˜

## ğŸ“‹ ç›®å½•
- [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
- [å¸¸è§é”™è¯¯å®ç°](#å¸¸è§é”™è¯¯å®ç°)
- [ä¸šç•Œæœ€ä½³å®è·µ](#ä¸šç•Œæœ€ä½³å®è·µ)
- [é—®é¢˜å¤ç›˜](#é—®é¢˜å¤ç›˜)
- [è§£å†³æ–¹æ¡ˆ](#è§£å†³æ–¹æ¡ˆ)
- [ä»£ç ç¤ºä¾‹](#ä»£ç ç¤ºä¾‹)

## ğŸ¯ é—®é¢˜èƒŒæ™¯

åœ¨å®ç°å›¾ç‰‡é¢„è§ˆåŠŸèƒ½æ—¶ï¼Œå›¾ç‰‡æ—‹è½¬æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ã€‚ç„¶è€Œï¼Œå¾ˆå¤šå®ç°éƒ½ä¼šé‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š

1. **"å¸¦ç€è¾¹ä¸€èµ·è½¬"**ï¼šå›¾ç‰‡æ—‹è½¬æ—¶ï¼ŒèƒŒæ™¯ã€é˜´å½±ã€è¾¹æ¡†ç­‰è£…é¥°å…ƒç´ ä¹Ÿè·Ÿç€æ—‹è½¬
2. **ä½ç½®åç§»**ï¼šæ—‹è½¬åå›¾ç‰‡ä½ç½®ä¸æ­£ç¡®ï¼Œå‡ºç°é ä¸‹æˆ–æº¢å‡ºçš„æƒ…å†µ
3. **å°ºå¯¸è®¡ç®—é”™è¯¯**ï¼šæ—‹è½¬åå›¾ç‰‡å°ºå¯¸ä¸ç¬¦åˆé¢„æœŸ
4. **åŒé‡å˜æ¢**ï¼šCSSå’ŒJavaScriptä¸­é‡å¤å¤„ç†å®½é«˜äº¤æ¢

## âŒ å¸¸è§é”™è¯¯å®ç°

### é”™è¯¯1ï¼šå®¹å™¨æ—‹è½¬
```javascript
// âŒ é”™è¯¯ï¼šæ•´ä¸ªå®¹å™¨éƒ½åœ¨æ—‹è½¬
<div 
  style={{
    transform: `rotate(${rotateDeg}deg)`, // å®¹å™¨è·Ÿç€è½¬ï¼
    width: `${cssWidth}px`,
    height: `${cssHeight}px`,
    backgroundColor: 'white',
    borderRadius: '8px',
    boxShadow: '0 4px 8px rgba(0,0,0,0.1)'
  }}
>
  <img src="..." />
</div>
```

**é—®é¢˜**ï¼šç”¨æˆ·çœ‹åˆ°çš„æ˜¯æ•´ä¸ªç™½è‰²èƒŒæ™¯å®¹å™¨è·Ÿç€å›¾ç‰‡ä¸€èµ·è½¬

### é”™è¯¯2ï¼šåŒé‡å°ºå¯¸å˜æ¢
```javascript
// âŒ é”™è¯¯ï¼šåŒé‡å˜æ¢
const rotatedAspect = rotateDeg % 180 === 90 ? 1 / imgAspect : imgAspect;
const rotatedIsPortrait = rotatedAspect < 1;

// getFittedSizeAfterRotate å†…éƒ¨å·²ç»å¤„ç†äº†90/270åº¦çš„å®½é«˜äº¤æ¢
const fittedSize = getFittedSizeAfterRotate(imgWidth, imgHeight, rotateDeg, viewMode);

// ä½†å¤–å±‚åˆåšäº†ä¸€æ¬¡è½´äº¤æ¢
const cssWidth = Math.round(isSwappedAxis ? fittedSize.height : fittedSize.width);
const cssHeight = Math.round(isSwappedAxis ? fittedSize.width : fittedSize.height);
```

**é—®é¢˜**ï¼šå¯¼è‡´å°ºå¯¸è®¡ç®—é”™è¯¯ï¼Œå›¾ç‰‡ä½ç½®åç§»

### é”™è¯¯3ï¼šè£…é¥°å…ƒç´ è·Ÿç€æ—‹è½¬
```javascript
// âŒ é”™è¯¯ï¼šé˜´å½±è¾¹æ¡†è·Ÿç€è½¬
<img 
  style={{
    transform: `rotate(${rotateDeg}deg)`,
    boxShadow: '0 4px 8px rgba(0,0,0,0.1)', // é˜´å½±è·Ÿç€è½¬ï¼
    border: '1px solid #ccc', // è¾¹æ¡†è·Ÿç€è½¬ï¼
    borderRadius: '8px' // åœ†è§’è·Ÿç€è½¬ï¼
  }}
/>
```

## âœ… ä¸šç•Œæœ€ä½³å®è·µ

### PhotoSwipe çš„å®ç°æ–¹å¼
```javascript
function rotateImage(angle) {
  const currentItem = this.currItem;
  const img = currentItem.container.querySelector('img');
  
  // è®¡ç®—æ—‹è½¬åçš„å°ºå¯¸
  const rotatedSize = this.getRotatedSize(currentItem, angle);
  
  // åº”ç”¨æ—‹è½¬å’Œå°ºå¯¸
  img.style.transform = `rotate(${angle}deg)`;
  img.style.width = rotatedSize.width + 'px';
  img.style.height = rotatedSize.height + 'px';
  
  // é‡æ–°å±…ä¸­
  this.updateSize();
}

function getRotatedSize(item, angle) {
  const isRotated = angle % 180 !== 0;
  const w = isRotated ? item.h : item.w;
  const h = isRotated ? item.w : item.h;
  
  return { width: w, height: h };
}
```

### react-image-gallery çš„å®ç°æ–¹å¼
```javascript
const ImageGallery = ({ items, currentIndex }) => {
  const [rotation, setRotation] = useState(0);
  
  const handleRotate = () => {
    setRotation(prev => (prev + 90) % 360);
  };
  
  const getImageStyle = (item) => {
    const isRotated = rotation % 180 !== 0;
    const aspectRatio = isRotated ? item.height / item.width : item.width / item.height;
    
    return {
      transform: `rotate(${rotation}deg)`,
      transformOrigin: 'center center',
      maxWidth: '100%',
      maxHeight: '100%',
      objectFit: 'contain'
    };
  };
  
  return (
    <div className="image-gallery">
      <img 
        src={items[currentIndex].original}
        style={getImageStyle(items[currentIndex])}
        alt=""
      />
    </div>
  );
};
```

### lightGallery çš„å®ç°æ–¹å¼
```javascript
function rotateSlide(angle) {
  const slide = this.getSlide(this.index);
  const img = slide.querySelector('.lg-image');
  
  // è®¡ç®—æ—‹è½¬åçš„å°ºå¯¸
  const rotatedDimensions = this.getRotatedDimensions(slide, angle);
  
  // åº”ç”¨å˜æ¢
  img.style.transform = `rotate(${angle}deg)`;
  img.style.width = rotatedDimensions.width + 'px';
  img.style.height = rotatedDimensions.height + 'px';
  
  // é‡æ–°å±…ä¸­
  this.centerSlide(slide);
}

function getRotatedDimensions(slide, angle) {
  const naturalWidth = slide.dataset.width;
  const naturalHeight = slide.dataset.height;
  
  const isRotated = angle % 180 !== 0;
  const displayWidth = isRotated ? naturalHeight : naturalWidth;
  const displayHeight = isRotated ? naturalWidth : naturalHeight;
  
  // è®¡ç®—é€‚åˆå®¹å™¨çš„å°ºå¯¸
  const containerWidth = this.container.clientWidth;
  const containerHeight = this.container.clientHeight;
  
  const scale = Math.min(
    containerWidth / displayWidth,
    containerHeight / displayHeight
  );
  
  return {
    width: displayWidth * scale,
    height: displayHeight * scale
  };
}
```

### Viewer.js çš„å®ç°æ–¹å¼
```javascript
function rotate(degree) {
  const image = this.image;
  const canvas = this.canvas;
  
  // è®¡ç®—æ—‹è½¬åçš„å°ºå¯¸
  const rotatedSize = this.getRotatedSize(degree);
  
  // åº”ç”¨æ—‹è½¬
  image.style.transform = `rotate(${degree}deg)`;
  image.style.transformOrigin = 'center center';
  
  // è°ƒæ•´å®¹å™¨å°ºå¯¸
  canvas.style.width = rotatedSize.width + 'px';
  canvas.style.height = rotatedSize.height + 'px';
  
  // é‡æ–°å±…ä¸­
  this.position();
}

function getRotatedSize(degree) {
  const isRotated = degree % 180 !== 0;
  const width = isRotated ? this.imageHeight : this.imageWidth;
  const height = isRotated ? this.imageWidth : this.imageHeight;
  
  return { width, height };
}
```

## ğŸ” é—®é¢˜å¤ç›˜

### é—®é¢˜1ï¼šä¸ºä»€ä¹ˆä¼šå‡ºç°"å¸¦ç€è¾¹ä¸€èµ·è½¬"ï¼Ÿ

**æ ¹æœ¬åŸå› **ï¼š
1. **å®¹å™¨æ—‹è½¬**ï¼šæ•´ä¸ªdivå®¹å™¨åœ¨æ—‹è½¬ï¼Œè€Œä¸æ˜¯åªæ—‹è½¬å›¾ç‰‡
2. **èƒŒæ™¯è‰²æ—‹è½¬**ï¼šç™½è‰²èƒŒæ™¯è·Ÿç€å›¾ç‰‡ä¸€èµ·è½¬
3. **è£…é¥°å…ƒç´ æ—‹è½¬**ï¼šé˜´å½±ã€è¾¹æ¡†ã€åœ†è§’ç­‰è£…é¥°å…ƒç´ è·Ÿç€è½¬

**é”™è¯¯ä»£ç **ï¼š
```javascript
// âŒ å®¹å™¨è·Ÿç€è½¬
<div style={{ transform: `rotate(${rotateDeg}deg)` }}>
  <img src="..." />
</div>
```

### é—®é¢˜2ï¼šä¸ºä»€ä¹ˆæ—‹è½¬åå›¾ç‰‡ä½ç½®ä¼šåç§»ï¼Ÿ

**æ ¹æœ¬åŸå› **ï¼š
1. **åŒé‡å°ºå¯¸å˜æ¢**ï¼š`getFittedSizeAfterRotate` å†…éƒ¨å·²ç»å¤„ç†äº†å®½é«˜äº¤æ¢ï¼Œå¤–å±‚åˆåšäº†ä¸€æ¬¡äº¤æ¢
2. **å®¹å™¨å°ºå¯¸ä¸åŒ¹é…**ï¼šCSSå®¹å™¨çš„å°ºå¯¸ä¸å®é™…æ—‹è½¬åçš„å›¾ç‰‡å°ºå¯¸ä¸åŒ¹é…
3. **å±…ä¸­è®¡ç®—é”™è¯¯**ï¼šæ—‹è½¬ä¸­å¿ƒä¸å®¹å™¨ä¸­å¿ƒä¸ä¸€è‡´

**é”™è¯¯ä»£ç **ï¼š
```javascript
// âŒ åŒé‡å˜æ¢
const fittedSize = getFittedSizeAfterRotate(imgWidth, imgHeight, rotateDeg, viewMode);
const cssWidth = Math.round(isSwappedAxis ? fittedSize.height : fittedSize.width); // åˆäº¤æ¢äº†ä¸€æ¬¡ï¼
const cssHeight = Math.round(isSwappedAxis ? fittedSize.width : fittedSize.height);
```

### é—®é¢˜3ï¼šä¸ºä»€ä¹ˆå°ºå¯¸è®¡ç®—ä¼šå‡ºé”™ï¼Ÿ

**æ ¹æœ¬åŸå› **ï¼š
1. **å‡è®¾å°ºå¯¸**ï¼šä½¿ç”¨å›ºå®šçš„å‡è®¾å°ºå¯¸è€Œä¸æ˜¯çœŸå®çš„å›¾ç‰‡å°ºå¯¸
2. **å½’ä¸€åŒ–é”™è¯¯**ï¼šä½¿ç”¨å½’ä¸€åŒ–å°ºå¯¸ï¼ˆ1, 1/imgAspectï¼‰è€Œä¸æ˜¯åƒç´ å°ºå¯¸
3. **æ—‹è½¬é€»è¾‘æ··ä¹±**ï¼š90/270åº¦çš„å¤„ç†é€»è¾‘ä¸ä¸€è‡´

**é”™è¯¯ä»£ç **ï¼š
```javascript
// âŒ ä½¿ç”¨å‡è®¾å°ºå¯¸
const imgWidth = 1200; // å‡è®¾å®½åº¦
const imgHeight = 1200 / imgAspect; // å‡è®¾é«˜åº¦
```

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ ¸å¿ƒåŸåˆ™
1. **åªæ—‹è½¬å›¾ç‰‡ï¼Œä¸æ—‹è½¬å®¹å™¨**
2. **ä½¿ç”¨çœŸå®çš„å›¾ç‰‡å°ºå¯¸è¿›è¡Œè®¡ç®—**
3. **é¿å…åŒé‡å°ºå¯¸å˜æ¢**
4. **ç¡®ä¿æ—‹è½¬ä¸­å¿ƒä¸å®¹å™¨ä¸­å¿ƒä¸€è‡´**
5. **è£…é¥°å…ƒç´ æ”¾åœ¨ä¸æ—‹è½¬çš„å®¹å™¨ä¸Š**

### æ–¹æ¡ˆ1ï¼šçº¯å›¾ç‰‡æ—‹è½¬
```javascript
// âœ… æ­£ç¡®ï¼šåªæœ‰å›¾ç‰‡æ—‹è½¬ï¼Œå®¹å™¨å›ºå®š
<div 
  style={{
    width: '100%',
    height: '100%',
    display: 'grid',
    placeItems: 'center',
    backgroundColor: 'transparent' // é€æ˜èƒŒæ™¯
  }}
>
  <img 
    src="..." 
    style={{
      transform: `rotate(${rotateDeg}deg)`,
      transformOrigin: 'center center',
      width: `${cssWidth}px`,
      height: `${cssHeight}px`,
      objectFit: 'contain'
      // ä¸è¦åœ¨è¿™é‡ŒåŠ èƒŒæ™¯ã€é˜´å½±ã€è¾¹æ¡†
    }}
  />
</div>
```

### æ–¹æ¡ˆ2ï¼šåˆ†ç¦»æ—‹è½¬å’Œè£…é¥°
```javascript
// âœ… æ­£ç¡®ï¼šè£…é¥°å…ƒç´ ä¸æ—‹è½¬
<div 
  style={{
    width: '100%',
    height: '100%',
    display: 'grid',
    placeItems: 'center'
  }}
>
  {/* è£…é¥°å®¹å™¨ - ä¸æ—‹è½¬ */}
  <div 
    style={{
      backgroundColor: 'white',
      borderRadius: '8px',
      boxShadow: '0 4px 8px rgba(0,0,0,0.1)',
      padding: '8px'
    }}
  >
    {/* å›¾ç‰‡ - åªæ—‹è½¬è¿™ä¸ª */}
    <img 
      src="..." 
      style={{
        transform: `rotate(${rotateDeg}deg)`,
        transformOrigin: 'center center',
        width: `${cssWidth}px`,
        height: `${cssHeight}px`,
        objectFit: 'contain'
      }}
    />
  </div>
</div>
```

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´çš„æ­£ç¡®å®ç°
```javascript
import React, { useState, useEffect, useCallback } from 'react';

const PhotoPreview = ({ photo, rotateDeg, viewMode = 'standard' }) => {
  const [imageDimensions, setImageDimensions] = useState({ width: 0, height: 0 });
  const [fittedSize, setFittedSize] = useState({ width: 0, height: 0 });

  // è®¡ç®—é€‚é…å°ºå¯¸
  const recomputeFittedSize = useCallback(() => {
    if (!photo || !imageDimensions.width || !imageDimensions.height) {
      setFittedSize({ width: 0, height: 0 });
      return;
    }

    const { width, height } = getFittedSizeAfterRotate(
      imageDimensions.width,
      imageDimensions.height,
      rotateDeg,
      viewMode
    );

    setFittedSize({
      width: Math.max(1, Math.round(width)),
      height: Math.max(1, Math.round(height))
    });
  }, [photo, imageDimensions.width, imageDimensions.height, rotateDeg, viewMode]);

  useEffect(() => {
    recomputeFittedSize();
  }, [recomputeFittedSize]);

  // ç›‘å¬çª—å£å¤§å°å˜åŒ–
  useEffect(() => {
    const handleResize = () => {
      recomputeFittedSize();
    };

    window.addEventListener('resize', handleResize);
    return () => window.removeEventListener('resize', handleResize);
  }, [recomputeFittedSize]);

  return (
    <div 
      style={{
        width: '100%',
        height: '100%',
        display: 'grid',
        placeItems: 'center',
        backgroundColor: 'transparent'
      }}
    >
      <img
        src={photo.original}
        alt={photo.title || 'ç…§ç‰‡'}
        style={{
          transform: `rotate(${rotateDeg}deg)`,
          transformOrigin: 'center center',
          width: `${fittedSize.width}px`,
          height: `${fittedSize.height}px`,
          objectFit: 'contain'
        }}
        onLoad={(e) => {
          const img = e.currentTarget;
          if (img && img.naturalWidth && img.naturalHeight) {
            setImageDimensions({ 
              width: img.naturalWidth, 
              height: img.naturalHeight 
            });
          }
        }}
      />
    </div>
  );
};

// å·¥å…·å‡½æ•°ï¼šè®¡ç®—æ—‹è½¬åçš„é€‚é…å°ºå¯¸
function getFittedSizeAfterRotate(imgWidth, imgHeight, rotateDeg, viewMode = 'standard') {
  if (!imgWidth || !imgHeight) return { width: 0, height: 0 };

  // è§„èŒƒè§’åº¦åˆ° [0,360)
  const norm = ((rotateDeg % 360) + 360) % 360;
  const swapped = norm === 90 || norm === 270;

  // æ—‹è½¬åç”¨äºè£…ç®±çš„å®½é«˜
  const rw = swapped ? imgHeight : imgWidth;
  const rh = swapped ? imgWidth : imgHeight;
  const ar = rw / rh; // æ—‹è½¬åå®½é«˜æ¯”

  // ç›®æ ‡æ¯”ä¾‹ï¼šæ²‰æµ¸=100%ï¼Œæ ‡å‡†=80%
  const MAX_W_RATIO = viewMode === 'immersive' ? 1 : 0.8;
  const MAX_H_RATIO = viewMode === 'immersive' ? 1 : 0.8;

  const vw = window.innerWidth;
  const vh = window.innerHeight;

  const maxW = vw * MAX_W_RATIO;
  const maxH = vh * MAX_H_RATIO;

  let width, height;

  if (ar >= 1) {
    // æ¨ªå‘å›¾ï¼ˆæ—‹è½¬åï¼‰
    width = Math.min(maxW, maxH * ar);
    height = width / ar;
    if (height > maxH) {
      height = maxH;
      width = height * ar;
    }
  } else {
    // ç«–å‘å›¾ï¼ˆæ—‹è½¬åï¼‰
    height = Math.min(maxH, maxW / ar);
    width = height * ar;
    if (width > maxW) {
      width = maxW;
      height = width / ar;
    }
  }

  return {
    width: Math.max(1, Math.floor(width)),
    height: Math.max(1, Math.floor(height)),
  };
}

export default PhotoPreview;
```

## ğŸ“š æ€»ç»“

### å…³é”®è¦ç‚¹
1. **åªæ—‹è½¬å›¾ç‰‡æœ¬èº«**ï¼Œä¸è¦æ—‹è½¬å®¹å™¨
2. **ä½¿ç”¨çœŸå®çš„å›¾ç‰‡å°ºå¯¸**è¿›è¡Œè®¡ç®—
3. **é¿å…åŒé‡å°ºå¯¸å˜æ¢**
4. **ç¡®ä¿æ—‹è½¬ä¸­å¿ƒæ­£ç¡®**
5. **è£…é¥°å…ƒç´ æ”¾åœ¨ä¸æ—‹è½¬çš„å®¹å™¨ä¸Š**

### é¿å…çš„é—®é¢˜
- âŒ å®¹å™¨è·Ÿç€å›¾ç‰‡ä¸€èµ·æ—‹è½¬
- âŒ å›¾ç‰‡ä½ç½®åç§»æˆ–æº¢å‡º
- âŒ åŒé‡å°ºå¯¸å˜æ¢
- âŒ æ—‹è½¬ä¸­å¿ƒä¸æ­£ç¡®
- âŒ ä½¿ç”¨å‡è®¾å°ºå¯¸è€Œä¸æ˜¯çœŸå®å°ºå¯¸

### æœ€ä½³å®è·µ
- âœ… åªæ—‹è½¬å›¾ç‰‡ï¼Œå®¹å™¨ä¿æŒå›ºå®š
- âœ… ä½¿ç”¨çœŸå®å›¾ç‰‡å°ºå¯¸è¿›è¡Œè®¡ç®—
- âœ… ä¸€æ¬¡æ€§çš„å°ºå¯¸å˜æ¢
- âœ… æ­£ç¡®çš„æ—‹è½¬ä¸­å¿ƒ
- âœ… åˆ†ç¦»æ—‹è½¬å’Œè£…é¥°é€»è¾‘

é€šè¿‡éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥é¿å…"å¸¦ç€è¾¹ä¸€èµ·è½¬"å’Œä½ç½®åç§»ç­‰é—®é¢˜ï¼Œå®ç°ä¸“ä¸šçº§çš„å›¾ç‰‡æ—‹è½¬åŠŸèƒ½ã€‚

## ğŸš¨ Codex ä¿®æ”¹é—®é¢˜åˆ†æ

### é—®é¢˜ä»£ç ï¼ˆç¬¬ 301-308 è¡Œï¼‰
```javascript
// âŒ é”™è¯¯ï¼šåŒé‡å°ºå¯¸å˜æ¢
const imageWidth = Math.max(
  1,
  Math.round(isRightAngle ? fittedSize.height : fittedSize.width)  // åˆäº¤æ¢äº†ä¸€æ¬¡ï¼
);
const imageHeight = Math.max(
  1,
  Math.round(isRightAngle ? fittedSize.width : fittedSize.height)  // åˆäº¤æ¢äº†ä¸€æ¬¡ï¼
);
```

### é—®é¢˜åˆ†æ
1. **åŒé‡å˜æ¢**ï¼š`getFittedSizeAfterRotate` å‡½æ•°å†…éƒ¨å·²ç»å¤„ç†äº† 90/270 åº¦çš„å®½é«˜äº¤æ¢ï¼Œä½†è¿™é‡Œåˆæ ¹æ® `isRightAngle` åšäº†ä¸€æ¬¡äº¤æ¢
2. **å®¹å™¨è·Ÿç€æ—‹è½¬**ï¼šå®¹å™¨ä½¿ç”¨äº†æ—‹è½¬åçš„å°ºå¯¸ï¼Œå¯¼è‡´"å¸¦ç€è¾¹ä¸€èµ·è½¬"
3. **å°ºå¯¸è®¡ç®—é”™è¯¯**ï¼šå›¾ç‰‡ä½¿ç”¨äº†é”™è¯¯çš„å°ºå¯¸ï¼Œå¯¼è‡´æ˜¾ç¤ºå¼‚å¸¸

### æ ¹æœ¬åŸå› 
æ²¡æœ‰ç†è§£ `getFittedSizeAfterRotate` å‡½æ•°å·²ç»å¤„ç†äº†æ—‹è½¬é€»è¾‘ï¼Œåœ¨å¤–å±‚åˆé‡å¤å¤„ç†äº†ä¸€æ¬¡ã€‚

### æ­£ç¡®çš„ä¿®å¤æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šç§»é™¤åŒé‡å˜æ¢
```javascript
// âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨ fittedSizeï¼Œä¸å†åšäºŒæ¬¡äº¤æ¢
const imageWidth = Math.max(1, Math.round(fittedSize.width));
const imageHeight = Math.max(1, Math.round(fittedSize.height));
```

#### æ–¹æ¡ˆ2ï¼šå›ºå®šå®¹å™¨å°ºå¯¸
```javascript
// âœ… æ­£ç¡®ï¼šå®¹å™¨ä½¿ç”¨å›ºå®šå°ºå¯¸ï¼Œä¸è·Ÿç€æ—‹è½¬
<div 
  className="relative transition-all duration-500 ease-out rounded-lg shadow-2xl overflow-hidden flex items-center justify-center"
  style={{
    width: '100%',        // å›ºå®šå®½åº¦
    height: '100%'       // å›ºå®šé«˜åº¦
  }}
>
```

#### æ–¹æ¡ˆ3ï¼šç®€åŒ–å›¾ç‰‡æ ·å¼
```javascript
// âœ… æ­£ç¡®ï¼šå›¾ç‰‡ä½¿ç”¨è®¡ç®—åçš„æ­£ç¡®å°ºå¯¸
<img
  style={{
    width: `${imageWidth}px`,
    height: `${imageHeight}px`,
    objectFit: 'contain',
    transform: `rotate(${rotateDeg}deg)`,
    transformOrigin: 'center center',
    transition: shouldAnimateRotation ? 'transform 0.2s ease-out' : 'none'
  }}
/>
```

### æ€»ç»“
Codex çš„ä¿®æ”¹å¼•å…¥äº†åŒé‡å°ºå¯¸å˜æ¢å’Œå®¹å™¨è·Ÿç€æ—‹è½¬çš„é—®é¢˜ï¼Œæ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰ç†è§£ `getFittedSizeAfterRotate` å‡½æ•°å·²ç»å¤„ç†äº†æ—‹è½¬é€»è¾‘ã€‚æ­£ç¡®çš„åšæ³•æ˜¯ç§»é™¤å¤–å±‚çš„ `isRightAngle` åˆ¤æ–­ï¼Œç›´æ¥ä½¿ç”¨ `fittedSize` çš„å®½é«˜ï¼Œå¹¶å›ºå®šå®¹å™¨å°ºå¯¸ã€‚

## ğŸŒŸ æ›´å¤šé¡¹ç›®æ—‹è½¬å®ç°ç¤ºä¾‹

### 1. React Image Gallery æ—‹è½¬å®ç°
```javascript
import React, { useState } from 'react';
import ImageGallery from 'react-image-gallery';

const CustomImageGallery = ({ items }) => {
  const [rotations, setRotations] = useState({});

  const handleRotate = (index) => {
    setRotations(prev => ({
      ...prev,
      [index]: (prev[index] || 0) + 90
    }));
  };

  const renderItem = (item) => {
    const rotation = rotations[item.original] || 0;
    return (
      <div className="image-gallery-image">
        <img
          src={item.original}
          alt={item.description}
          style={{
            transform: `rotate(${rotation}deg)`,
            transformOrigin: 'center center',
            transition: 'transform 0.3s ease',
            maxWidth: '100%',
            maxHeight: '100%',
            objectFit: 'contain'
          }}
        />
        <button
          onClick={() => handleRotate(item.original)}
          className="rotate-btn"
          style={{
            position: 'absolute',
            top: '10px',
            right: '10px',
            background: 'rgba(0,0,0,0.7)',
            color: 'white',
            border: 'none',
            borderRadius: '4px',
            padding: '8px',
            cursor: 'pointer'
          }}
        >
          â†»
        </button>
      </div>
    );
  };

  return (
    <ImageGallery
      items={items}
      renderItem={renderItem}
      showThumbnails={false}
      showFullscreenButton={false}
      showPlayButton={false}
    />
  );
};
```

### 2. React Image Zoom æ—‹è½¬å®ç°
```javascript
import React, { useState } from 'react';
import ImageZoom from 'react-image-zoom';

const RotatableImageZoom = ({ src, alt }) => {
  const [rotation, setRotation] = useState(0);

  const handleRotate = () => {
    setRotation(prev => (prev + 90) % 360);
  };

  const imageProps = {
    src,
    alt,
    style: {
      transform: `rotate(${rotation}deg)`,
      transformOrigin: 'center center',
      transition: 'transform 0.3s ease',
      maxWidth: '100%',
      maxHeight: '100%'
    }
  };

  return (
    <div style={{ position: 'relative' }}>
      <ImageZoom {...imageProps} />
      <button
        onClick={handleRotate}
        style={{
          position: 'absolute',
          top: '10px',
          right: '10px',
          background: 'rgba(0,0,0,0.7)',
          color: 'white',
          border: 'none',
          borderRadius: '4px',
          padding: '8px',
          cursor: 'pointer'
        }}
      >
        â†» æ—‹è½¬
      </button>
    </div>
  );
};
```

### 3. React Image Lightbox æ—‹è½¬å®ç°
```javascript
import React, { useState } from 'react';
import Lightbox from 'react-image-lightbox';

const RotatableLightbox = ({ images, isOpen, onClose, photoIndex }) => {
  const [rotations, setRotations] = useState({});

  const handleRotate = () => {
    setRotations(prev => ({
      ...prev,
      [photoIndex]: (prev[photoIndex] || 0) + 90
    }));
  };

  const currentRotation = rotations[photoIndex] || 0;

  return (
    <>
      {isOpen && (
        <Lightbox
          mainSrc={images[photoIndex]}
          nextSrc={images[(photoIndex + 1) % images.length]}
          prevSrc={images[(photoIndex + images.length - 1) % images.length]}
          onCloseRequest={onClose}
          onMovePrevRequest={() => setPhotoIndex((photoIndex + images.length - 1) % images.length)}
          onMoveNextRequest={() => setPhotoIndex((photoIndex + 1) % images.length)}
          toolbarButtons={[
            <button
              key="rotate"
              onClick={handleRotate}
              style={{
                background: 'rgba(0,0,0,0.7)',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                padding: '8px 12px',
                cursor: 'pointer',
                marginRight: '10px'
              }}
            >
              â†» æ—‹è½¬
            </button>
          ]}
          imageTitle={`å›¾ç‰‡ ${photoIndex + 1} / ${images.length}`}
          imageCaption={`æ—‹è½¬è§’åº¦: ${currentRotation}Â°`}
        />
      )}
    </>
  );
};
```

### 4. åŸç”Ÿ JavaScript å›¾ç‰‡æ—‹è½¬å®ç°
```javascript
class ImageRotator {
  constructor(containerId) {
    this.container = document.getElementById(containerId);
    this.rotation = 0;
    this.image = null;
    this.init();
  }

  init() {
    this.image = this.container.querySelector('img');
    this.createControls();
    this.bindEvents();
  }

  createControls() {
    const controls = document.createElement('div');
    controls.className = 'image-rotator-controls';
    controls.innerHTML = `
      <button class="rotate-left">â†º å·¦è½¬</button>
      <button class="rotate-right">â†» å³è½¬</button>
      <button class="reset-rotation">â†» é‡ç½®</button>
    `;
    this.container.appendChild(controls);
  }

  bindEvents() {
    const leftBtn = this.container.querySelector('.rotate-left');
    const rightBtn = this.container.querySelector('.rotate-right');
    const resetBtn = this.container.querySelector('.reset-rotation');

    leftBtn.addEventListener('click', () => this.rotate(-90));
    rightBtn.addEventListener('click', () => this.rotate(90));
    resetBtn.addEventListener('click', () => this.reset());
  }

  rotate(degrees) {
    this.rotation += degrees;
    this.applyRotation();
  }

  reset() {
    this.rotation = 0;
    this.applyRotation();
  }

  applyRotation() {
    if (this.image) {
      this.image.style.transform = `rotate(${this.rotation}deg)`;
      this.image.style.transformOrigin = 'center center';
      this.image.style.transition = 'transform 0.3s ease';
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const rotator = new ImageRotator('image-container');
```

### 5. Vue.js å›¾ç‰‡æ—‹è½¬å®ç°
```vue
<template>
  <div class="image-rotator">
    <div class="image-container">
      <img
        :src="imageSrc"
        :alt="imageAlt"
        :style="imageStyle"
        @load="onImageLoad"
      />
    </div>
    <div class="controls">
      <button @click="rotateLeft">â†º å·¦è½¬</button>
      <button @click="rotateRight">â†» å³è½¬</button>
      <button @click="resetRotation">â†» é‡ç½®</button>
    </div>
  </div>
</template>

<script>
export default {
  name: 'ImageRotator',
  props: {
    imageSrc: String,
    imageAlt: String
  },
  data() {
    return {
      rotation: 0,
      imageLoaded: false
    };
  },
  computed: {
    imageStyle() {
      return {
        transform: `rotate(${this.rotation}deg)`,
        transformOrigin: 'center center',
        transition: 'transform 0.3s ease',
        maxWidth: '100%',
        maxHeight: '100%',
        objectFit: 'contain'
      };
    }
  },
  methods: {
    rotateLeft() {
      this.rotation -= 90;
    },
    rotateRight() {
      this.rotation += 90;
    },
    resetRotation() {
      this.rotation = 0;
    },
    onImageLoad() {
      this.imageLoaded = true;
    }
  }
};
</script>

<style scoped>
.image-rotator {
  position: relative;
  display: inline-block;
}

.image-container {
  position: relative;
  overflow: hidden;
}

.controls {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 5px;
}

.controls button {
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  border-radius: 4px;
  padding: 8px 12px;
  cursor: pointer;
  font-size: 12px;
}

.controls button:hover {
  background: rgba(0, 0, 0, 0.9);
}
</style>
```

### 6. Angular å›¾ç‰‡æ—‹è½¬å®ç°
```typescript
import { Component, Input, OnInit } from '@angular/core';

@Component({
  selector: 'app-image-rotator',
  template: `
    <div class="image-rotator">
      <div class="image-container">
        <img
          [src]="imageSrc"
          [alt]="imageAlt"
          [style.transform]="'rotate(' + rotation + 'deg)'"
          [style.transform-origin]="'center center'"
          [style.transition]="'transform 0.3s ease'"
          (load)="onImageLoad()"
        />
      </div>
      <div class="controls">
        <button (click)="rotateLeft()">â†º å·¦è½¬</button>
        <button (click)="rotateRight()">â†» å³è½¬</button>
        <button (click)="resetRotation()">â†» é‡ç½®</button>
      </div>
    </div>
  `,
  styles: [`
    .image-rotator {
      position: relative;
      display: inline-block;
    }
    
    .image-container {
      position: relative;
      overflow: hidden;
    }
    
    .controls {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }
    
    .controls button {
      background: rgba(0, 0, 0, 0.7);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .controls button:hover {
      background: rgba(0, 0, 0, 0.9);
    }
  `]
})
export class ImageRotatorComponent implements OnInit {
  @Input() imageSrc: string = '';
  @Input() imageAlt: string = '';
  
  rotation: number = 0;
  imageLoaded: boolean = false;

  ngOnInit() {}

  rotateLeft() {
    this.rotation -= 90;
  }

  rotateRight() {
    this.rotation += 90;
  }

  resetRotation() {
    this.rotation = 0;
  }

  onImageLoad() {
    this.imageLoaded = true;
  }
}
```

### 7. CSS çº¯æ ·å¼æ—‹è½¬å®ç°
```css
/* åŸºç¡€æ—‹è½¬æ ·å¼ */
.rotatable-image {
  transition: transform 0.3s ease;
  transform-origin: center center;
}

/* æ—‹è½¬çŠ¶æ€ç±» */
.rotate-90 { transform: rotate(90deg); }
.rotate-180 { transform: rotate(180deg); }
.rotate-270 { transform: rotate(270deg); }

/* æ‚¬åœæ•ˆæœ */
.rotatable-image:hover {
  transform: scale(1.05);
}

/* åŠ¨ç”»å…³é”®å¸§ */
@keyframes rotate {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

.rotating-image {
  animation: rotate 2s linear infinite;
}

/* 3D æ—‹è½¬æ•ˆæœ */
.image-3d {
  transform-style: preserve-3d;
  transition: transform 0.5s ease;
}

.image-3d:hover {
  transform: rotateY(180deg);
}
```

### 8. ç§»åŠ¨ç«¯è§¦æ‘¸æ—‹è½¬å®ç°
```javascript
class TouchImageRotator {
  constructor(element) {
    this.element = element;
    this.rotation = 0;
    this.lastTouchAngle = 0;
    this.isRotating = false;
    this.init();
  }

  init() {
    this.element.addEventListener('touchstart', this.handleTouchStart.bind(this));
    this.element.addEventListener('touchmove', this.handleTouchMove.bind(this));
    this.element.addEventListener('touchend', this.handleTouchEnd.bind(this));
  }

  handleTouchStart(e) {
    if (e.touches.length === 2) {
      this.isRotating = true;
      const touch1 = e.touches[0];
      const touch2 = e.touches[1];
      this.lastTouchAngle = this.getAngle(touch1, touch2);
    }
  }

  handleTouchMove(e) {
    if (this.isRotating && e.touches.length === 2) {
      e.preventDefault();
      const touch1 = e.touches[0];
      const touch2 = e.touches[1];
      const currentAngle = this.getAngle(touch1, touch2);
      const angleDiff = currentAngle - this.lastTouchAngle;
      
      this.rotation += angleDiff;
      this.applyRotation();
      
      this.lastTouchAngle = currentAngle;
    }
  }

  handleTouchEnd(e) {
    this.isRotating = false;
  }

  getAngle(touch1, touch2) {
    const dx = touch2.clientX - touch1.clientX;
    const dy = touch2.clientY - touch1.clientY;
    return Math.atan2(dy, dx) * 180 / Math.PI;
  }

  applyRotation() {
    this.element.style.transform = `rotate(${this.rotation}deg)`;
    this.element.style.transformOrigin = 'center center';
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const imageElement = document.querySelector('.rotatable-image');
const rotator = new TouchImageRotator(imageElement);
```

### 9. æœåŠ¡ç«¯å›¾ç‰‡æ—‹è½¬å®ç° (Node.js + Sharp)
```javascript
const sharp = require('sharp');
const path = require('path');

class ImageRotationService {
  static async rotateImage(inputPath, outputPath, degrees) {
    try {
      await sharp(inputPath)
        .rotate(degrees)
        .jpeg({ quality: 90 })
        .toFile(outputPath);
      
      console.log(`å›¾ç‰‡æ—‹è½¬å®Œæˆ: ${outputPath}`);
      return outputPath;
    } catch (error) {
      console.error('å›¾ç‰‡æ—‹è½¬å¤±è´¥:', error);
      throw error;
    }
  }

  static async rotateImageBuffer(buffer, degrees) {
    try {
      const rotatedBuffer = await sharp(buffer)
        .rotate(degrees)
        .jpeg({ quality: 90 })
        .toBuffer();
      
      return rotatedBuffer;
    } catch (error) {
      console.error('å›¾ç‰‡æ—‹è½¬å¤±è´¥:', error);
      throw error;
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const inputPath = './input.jpg';
const outputPath = './output.jpg';
const degrees = 90;

ImageRotationService.rotateImage(inputPath, outputPath, degrees)
  .then(result => console.log('æ—‹è½¬å®Œæˆ:', result))
  .catch(error => console.error('æ—‹è½¬å¤±è´¥:', error));
```

### 10. å®Œæ•´çš„ React Hook æ—‹è½¬å®ç°
```javascript
import { useState, useCallback, useRef, useEffect } from 'react';

const useImageRotation = (initialRotation = 0) => {
  const [rotation, setRotation] = useState(initialRotation);
  const [isAnimating, setIsAnimating] = useState(false);
  const imageRef = useRef(null);

  const rotate = useCallback((degrees) => {
    setIsAnimating(true);
    setRotation(prev => prev + degrees);
  }, []);

  const rotateLeft = useCallback(() => rotate(-90), [rotate]);
  const rotateRight = useCallback(() => rotate(90), [rotate]);
  const reset = useCallback(() => {
    setIsAnimating(true);
    setRotation(0);
  }, []);

  const onTransitionEnd = useCallback(() => {
    setIsAnimating(false);
  }, []);

  useEffect(() => {
    if (imageRef.current) {
      imageRef.current.style.transform = `rotate(${rotation}deg)`;
      imageRef.current.style.transformOrigin = 'center center';
      imageRef.current.style.transition = isAnimating ? 'transform 0.3s ease' : 'none';
    }
  }, [rotation, isAnimating]);

  return {
    rotation,
    isAnimating,
    imageRef,
    rotateLeft,
    rotateRight,
    reset,
    onTransitionEnd
  };
};

// ä½¿ç”¨ç¤ºä¾‹
const ImageComponent = ({ src, alt }) => {
  const {
    rotation,
    isAnimating,
    imageRef,
    rotateLeft,
    rotateRight,
    reset,
    onTransitionEnd
  } = useImageRotation();

  return (
    <div className="image-container">
      <img
        ref={imageRef}
        src={src}
        alt={alt}
        onTransitionEnd={onTransitionEnd}
      />
      <div className="controls">
        <button onClick={rotateLeft}>â†º å·¦è½¬</button>
        <button onClick={rotateRight}>â†» å³è½¬</button>
        <button onClick={reset}>â†» é‡ç½®</button>
      </div>
    </div>
  );
};
```

è¿™äº›ç¤ºä¾‹æ¶µç›–äº†ä¸åŒæ¡†æ¶å’Œåœºæ™¯ä¸‹çš„å›¾ç‰‡æ—‹è½¬å®ç°ï¼Œå¯ä»¥ä½œä¸ºå‚è€ƒå’Œå­¦ä¹ çš„ææ–™ã€‚

## ğŸš¨ Codex æœ€æ–°ä¿®æ”¹é—®é¢˜åˆ†æï¼ˆç¬¬äºŒæ¬¡ï¼‰

### é—®é¢˜ä»£ç ï¼ˆç¬¬ 416-419 è¡Œï¼‰
```javascript
// âŒ é”™è¯¯ï¼šå®¹å™¨ä½¿ç”¨æ—‹è½¬åçš„å°ºå¯¸
style={{
  width: `${stageWidth}px`,    // å®¹å™¨è·Ÿç€æ—‹è½¬ï¼
  height: `${stageHeight}px`   // å®¹å™¨è·Ÿç€æ—‹è½¬ï¼
}}
```

### é—®é¢˜åˆ†æ
1. **å®¹å™¨è·Ÿç€æ—‹è½¬**ï¼š`stageWidth` å’Œ `stageHeight` æ˜¯åŸºäº `fittedSize` è®¡ç®—çš„ï¼Œè€Œ `fittedSize` æ˜¯æ—‹è½¬åçš„å°ºå¯¸
2. **å›¾ç‰‡å°ºå¯¸é”™è¯¯**ï¼šå›¾ç‰‡ä½¿ç”¨äº†å®¹å™¨çš„å°ºå¯¸ï¼Œè€Œä¸æ˜¯è®¡ç®—åçš„æ­£ç¡®å°ºå¯¸
3. **å°ºå¯¸è®¡ç®—æ··ä¹±**ï¼š`stageWidth` å’Œ `stageHeight` ç›´æ¥ä½¿ç”¨äº† `fittedSize`ï¼Œå¯¼è‡´å®¹å™¨è·Ÿç€æ—‹è½¬

### æ ¹æœ¬åŸå› 
æ²¡æœ‰ç†è§£å®¹å™¨åº”è¯¥ä¿æŒå›ºå®šå°ºå¯¸ï¼Œåªæœ‰å›¾ç‰‡æœ¬èº«æ‰åº”è¯¥æ—‹è½¬å’Œè°ƒæ•´å°ºå¯¸ã€‚

### æ­£ç¡®çš„ä¿®å¤æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šå›ºå®šå®¹å™¨å°ºå¯¸
```javascript
// âœ… æ­£ç¡®ï¼šå®¹å™¨ä½¿ç”¨å›ºå®šå°ºå¯¸ï¼Œä¸è·Ÿç€æ—‹è½¬
<div 
  className="relative transition-all duration-500 ease-out rounded-lg shadow-2xl overflow-hidden flex items-center justify-center"
  style={{
    width: '100%',        // å›ºå®šå®½åº¦
    height: '100%'       // å›ºå®šé«˜åº¦
  }}
>
```

#### æ–¹æ¡ˆ2ï¼šå›¾ç‰‡ä½¿ç”¨è®¡ç®—åçš„æ­£ç¡®å°ºå¯¸
```javascript
// âœ… æ­£ç¡®ï¼šå›¾ç‰‡ä½¿ç”¨ fittedSize çš„å°ºå¯¸
<img
  style={{
    width: `${fittedSize.width}px`,
    height: `${fittedSize.height}px`,
    objectFit: 'contain',
    transform: `rotate(${rotateDeg}deg)`,
    transformOrigin: 'center center',
    transition: shouldAnimateRotation ? 'transform 0.2s ease-out' : 'none'
  }}
/>
```

#### æ–¹æ¡ˆ3ï¼šç§»é™¤ stageWidth/stageHeight
```javascript
// âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨ fittedSizeï¼Œä¸éœ€è¦ stageWidth/stageHeight
// åˆ é™¤è¿™ä¸¤è¡Œï¼š
// const stageWidth = Math.max(1, Math.round(fittedSize.width));
// const stageHeight = Math.max(1, Math.round(fittedSize.height));
```

### æ€»ç»“
Codex çš„ç¬¬äºŒæ¬¡ä¿®æ”¹ä»ç„¶å­˜åœ¨"å¸¦ç€è¾¹ä¸€èµ·è½¬"çš„é—®é¢˜ï¼Œæ ¹æœ¬åŸå› æ˜¯æ²¡æœ‰ç†è§£å®¹å™¨åº”è¯¥ä¿æŒå›ºå®šå°ºå¯¸ï¼Œåªæœ‰å›¾ç‰‡æœ¬èº«æ‰åº”è¯¥æ—‹è½¬å’Œè°ƒæ•´å°ºå¯¸ã€‚æ­£ç¡®çš„åšæ³•æ˜¯å®¹å™¨ä½¿ç”¨å›ºå®šå°ºå¯¸ï¼Œå›¾ç‰‡ä½¿ç”¨ `fittedSize` çš„å°ºå¯¸ï¼Œå¹¶ç§»é™¤ `stageWidth` å’Œ `stageHeight` å˜é‡ã€‚

## ğŸ” Codex ç¬¬ä¸‰æ¬¡ä¿®æ”¹é—®é¢˜åˆ†æï¼šæ—‹è½¬æ—¶çš„"æ¡†"

### é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆï¼š"æ—‹è½¬çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ªæ¡†ï¼Œè™½ç„¶æœ€ç»ˆæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ—‹è½¬çš„è¿‡ç¨‹ä¸­è‚‰çœ¼å¯è§è¿™ä¸ªè¾¹æ¡†é™åˆ¶äº†å›¾ç‰‡"

### é—®é¢˜åˆ†æ

#### 1. `overflow: hidden` çš„å®¹å™¨è¾¹ç•Œ
**é—®é¢˜ä½ç½®**ï¼šç¬¬ 414 è¡Œ
```javascript
// âŒ é”™è¯¯ï¼šå®¹å™¨è®¾ç½®äº† overflow: hidden
className={`relative transition-all duration-500 ease-out rounded-lg shadow-2xl overflow-hidden flex items-center justify-center`}
```

**é—®é¢˜åˆ†æ**ï¼š
- å®¹å™¨è®¾ç½®äº† `overflow: hidden`
- å½“å›¾ç‰‡æ—‹è½¬æ—¶ï¼Œåœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæš‚æ—¶è¶…å‡ºå®¹å™¨çš„è¾¹ç•Œ
- è¿™ä¸ªå®¹å™¨çš„è¾¹ç•Œå°±åƒä¸€ä¸ª"æ¡†"ä¸€æ ·ï¼Œè£å‰ªæ‰è¶…å‡ºéƒ¨åˆ†

#### 2. å®¹å™¨å°ºå¯¸é™åˆ¶
**é—®é¢˜ä½ç½®**ï¼šç¬¬ 427-429 è¡Œ
```javascript
// âŒ é”™è¯¯ï¼šå®¹å™¨å°ºå¯¸å›ºå®š
style={{
  width: `${stageWidth}px`,    // å®¹å™¨å°ºå¯¸å›ºå®š
  height: `${stageHeight}px`   // å®¹å™¨å°ºå¯¸å›ºå®š
}}
```

**é—®é¢˜åˆ†æ**ï¼š
- å®¹å™¨ä½¿ç”¨äº†å›ºå®šçš„ `stageWidth` å’Œ `stageHeight`
- è¿™äº›å°ºå¯¸æ˜¯åŸºäºæ—‹è½¬åçš„å›¾ç‰‡è®¡ç®—çš„
- ä½†åœ¨æ—‹è½¬åŠ¨ç”»è¿‡ç¨‹ä¸­ï¼Œå›¾ç‰‡å¯èƒ½ä¼šæš‚æ—¶è¶…å‡ºè¿™ä¸ªå›ºå®šå®¹å™¨çš„è¾¹ç•Œ

#### 3. åŒé‡å°ºå¯¸å˜æ¢
**é—®é¢˜ä½ç½®**ï¼šç¬¬ 301-308 è¡Œ
```javascript
// âŒ é”™è¯¯ï¼šåŒé‡å°ºå¯¸å˜æ¢
const imageWidth = Math.max(
  1,
  Math.round(isRightAngle ? fittedSize.height : fittedSize.width)  // åˆäº¤æ¢äº†ä¸€æ¬¡ï¼
);
const imageHeight = Math.max(
  1,
  Math.round(isRightAngle ? fittedSize.width : fittedSize.height)  // åˆäº¤æ¢äº†ä¸€æ¬¡ï¼
);
```

**é—®é¢˜åˆ†æ**ï¼š
- `getFittedSizeAfterRotate` å†…éƒ¨å·²ç»å¤„ç†äº†æ—‹è½¬
- ä½†è¿™é‡Œåˆæ ¹æ® `isRightAngle` åšäº†ä¸€æ¬¡äº¤æ¢
- è¿™å¯èƒ½å¯¼è‡´å›¾ç‰‡å°ºå¯¸åœ¨åŠ¨ç”»è¿‡ç¨‹ä¸­å‡ºç°ä¸ä¸€è‡´

### è§£å†³æ–¹æ¡ˆ

#### æ–¹æ¡ˆ1ï¼šç§»é™¤å®¹å™¨çš„ `overflow: hidden`
```javascript
// âœ… æ­£ç¡®ï¼šç§»é™¤ overflow: hiddenï¼Œè®©å›¾ç‰‡å¯ä»¥è‡ªç”±æ—‹è½¬
className={`relative transition-all duration-500 ease-out rounded-lg shadow-2xl flex items-center justify-center`}
```

#### æ–¹æ¡ˆ2ï¼šä½¿ç”¨æ›´å¤§çš„å®¹å™¨å°ºå¯¸
```javascript
// âœ… æ­£ç¡®ï¼šå®¹å™¨ä½¿ç”¨æ›´å¤§çš„å°ºå¯¸ï¼Œé¿å…è£å‰ª
const containerSize = Math.max(stageWidth, stageHeight) * 1.2; // å¢åŠ 20%çš„ç¼“å†²
style={{
  width: `${containerSize}px`,
  height: `${containerSize}px`
}}
```

#### æ–¹æ¡ˆ3ï¼šç§»é™¤åŒé‡å°ºå¯¸å˜æ¢
```javascript
// âœ… æ­£ç¡®ï¼šç›´æ¥ä½¿ç”¨ fittedSizeï¼Œä¸å†åšäºŒæ¬¡äº¤æ¢
const imageWidth = Math.max(1, Math.round(fittedSize.width));
const imageHeight = Math.max(1, Math.round(fittedSize.height));
```

#### æ–¹æ¡ˆ4ï¼šä¼˜åŒ–åŠ¨ç”»è¿‡æ¸¡
```javascript
// âœ… æ­£ç¡®ï¼šä½¿ç”¨æ›´å¹³æ»‘çš„åŠ¨ç”»
transition: shouldAnimateRotation ? 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)' : 'none'
```

### æ¨èçš„ç»¼åˆè§£å†³æ–¹æ¡ˆ
```javascript
// 1. ç§»é™¤ overflow: hidden
className={`relative transition-all duration-500 ease-out rounded-lg shadow-2xl flex items-center justify-center`}

// 2. ä½¿ç”¨æ›´å¤§çš„å®¹å™¨å°ºå¯¸
const containerSize = Math.max(fittedSize.width, fittedSize.height) * 1.2;
style={{
  width: `${containerSize}px`,
  height: `${containerSize}px`
}}

// 3. ç›´æ¥ä½¿ç”¨ fittedSize
const imageWidth = Math.max(1, Math.round(fittedSize.width));
const imageHeight = Math.max(1, Math.round(fittedSize.height));

// 4. ä¼˜åŒ–åŠ¨ç”»
transition: shouldAnimateRotation ? 'transform 0.3s cubic-bezier(0.4, 0, 0.2, 1)' : 'none'
```

### æ€»ç»“
æ—‹è½¬æ—¶å‡ºç°"æ¡†"çš„é—®é¢˜ä¸»è¦ç”± `overflow: hidden`ã€å›ºå®šå®¹å™¨å°ºå¯¸å’ŒåŒé‡å°ºå¯¸å˜æ¢é€ æˆã€‚è§£å†³æ–¹æ¡ˆæ˜¯ç§»é™¤ `overflow: hidden`ï¼Œä½¿ç”¨æ›´å¤§çš„å®¹å™¨å°ºå¯¸ï¼Œç§»é™¤åŒé‡å°ºå¯¸å˜æ¢ï¼Œå¹¶ä¼˜åŒ–åŠ¨ç”»è¿‡æ¸¡æ•ˆæœã€‚

## âš ï¸ ç§»é™¤ overflow: hidden å¯èƒ½å¸¦æ¥çš„é—®é¢˜

### é—®é¢˜åˆ†æ
ç§»é™¤ `overflow: hidden` ç¡®å®ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼š

#### 1. è§†è§‰é—®é¢˜
```javascript
// âŒ ç§»é™¤åçš„é—®é¢˜
className="... rounded-lg shadow-2xl ..."  // æ²¡æœ‰ overflow: hidden

// é—®é¢˜ï¼š
// - é˜´å½±æ•ˆæœå¯èƒ½è¶…å‡ºå®¹å™¨è¾¹ç•Œï¼Œçœ‹èµ·æ¥ä¸å®Œæ•´
// - åœ†è§’æ•ˆæœå¯èƒ½ä¸å®Œæ•´ï¼Œå›¾ç‰‡è¾¹è§’è¶…å‡ºåœ†è§’è¾¹ç•Œ
// - æ•´ä½“è§†è§‰æ•ˆæœä¸ä¸€è‡´
```

#### 2. å¸ƒå±€å½±å“
```javascript
// âŒ å¯èƒ½çš„é—®é¢˜
// - å›¾ç‰‡è¶…å‡ºå®¹å™¨å¯èƒ½é®æŒ¡å…¶ä»–UIå…ƒç´ 
// - å¯¼èˆªæŒ‰é’®ã€å·¥å…·æ å¯èƒ½è¢«é®æŒ¡
// - é¡µé¢å¸ƒå±€å¯èƒ½è¢«ç ´å
```

#### 3. äº¤äº’é—®é¢˜
```javascript
// âŒ å¯èƒ½çš„é—®é¢˜
// - ç‚¹å‡»åŒºåŸŸå¯èƒ½ä¸å‡†ç¡®
// - å…¶ä»–å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶å¯èƒ½è¢«å½±å“
```

## ğŸ› ï¸ æ›´å¥½çš„è§£å†³æ–¹æ¡ˆï¼šåŠ¨æ€è°ƒæ•´å®¹å™¨å°ºå¯¸

### æ–¹æ¡ˆ1ï¼šä¿æŒ overflow: hiddenï¼Œä½†åŠ¨æ€è°ƒæ•´å®¹å™¨å°ºå¯¸ï¼ˆæ¨èï¼‰
```javascript
// âœ… æ­£ç¡®çš„åšæ³•
const calculateContainerSize = (fittedSize, rotateDeg) => {
  const radians = rotateDeg * (Math.PI / 180);
  const cos = Math.abs(Math.cos(radians));
  const sin = Math.abs(Math.sin(radians));
  
  // è®¡ç®—æ—‹è½¬åéœ€è¦çš„å®¹å™¨å°ºå¯¸
  const containerWidth = fittedSize.width * cos + fittedSize.height * sin;
  const containerHeight = fittedSize.width * sin + fittedSize.height * cos;
  
  // å¢åŠ ä¸€äº›ç¼“å†²ï¼Œç¡®ä¿å›¾ç‰‡å®Œå…¨æ˜¾ç¤º
  const buffer = 20; // 20px ç¼“å†²
  
  return {
    width: `${containerWidth + buffer}px`,
    height: `${containerHeight + buffer}px`
  };
};

// ä½¿ç”¨
const containerSize = calculateContainerSize(fittedSize, rotateDeg);

<div 
  className="relative transition-all duration-500 ease-out rounded-lg shadow-2xl overflow-hidden flex items-center justify-center"
  style={containerSize}
>
  <img
    style={{
      width: `${fittedSize.width}px`,
      height: `${fittedSize.height}px`,
      transform: `rotate(${rotateDeg}deg)`,
      transformOrigin: 'center center'
    }}
  />
</div>
```

### æ–¹æ¡ˆ2ï¼šä½¿ç”¨ overflow: visible ä½†é™åˆ¶åœ¨ç‰¹å®šåŒºåŸŸ
```javascript
// âœ… å¦ä¸€ç§åšæ³•
<div className="relative flex-1 grid place-items-center">
  <div 
    className="relative transition-all duration-500 ease-out rounded-lg shadow-2xl flex items-center justify-center"
    style={{
      width: `${fittedSize.width * 1.5}px`,  // ä½¿ç”¨æ›´å¤§çš„å®¹å™¨
      height: `${fittedSize.height * 1.5}px`,
      overflow: 'visible'  // å…è®¸æº¢å‡º
    }}
  >
    <img
      style={{
        width: `${fittedSize.width}px`,
        height: `${fittedSize.height}px`,
        transform: `rotate(${rotateDeg}deg)`,
        transformOrigin: 'center center'
      }}
    />
  </div>
</div>
```

### æ–¹æ¡ˆ3ï¼šæ—‹è½¬æ—¶ä¸´æ—¶è°ƒæ•´ overflow
```javascript
// âœ… åŠ¨æ€è°ƒæ•´ overflow
const [isRotating, setIsRotating] = useState(false);

const handleRotate = () => {
  setIsRotating(true);
  setRotateDeg(prev => prev + 90);
  
  // æ—‹è½¬å®Œæˆåæ¢å¤ overflow: hidden
  setTimeout(() => {
    setIsRotating(false);
  }, 300); // åŠ¨ç”»æŒç»­æ—¶é—´
};

<div 
  className={`relative transition-all duration-500 ease-out rounded-lg shadow-2xl flex items-center justify-center ${
    isRotating ? 'overflow-visible' : 'overflow-hidden'
  }`}
>
```

## ğŸ“‹ æ¨èæ–¹æ¡ˆ

æ¨èä½¿ç”¨**æ–¹æ¡ˆ1**ï¼Œå› ä¸ºï¼š

1. **ä¿æŒè§†è§‰ä¸€è‡´æ€§**ï¼šç»´æŒ `overflow: hidden` å’Œåœ†è§’ã€é˜´å½±æ•ˆæœ
2. **è§£å†³"æ¡†"é—®é¢˜**ï¼šåŠ¨æ€è°ƒæ•´å®¹å™¨å°ºå¯¸ï¼Œç¡®ä¿å›¾ç‰‡å®Œå…¨æ˜¾ç¤º
3. **é¿å…å¸ƒå±€é—®é¢˜**ï¼šä¸ä¼šå½±å“å…¶ä»–UIå…ƒç´ 
4. **æ€§èƒ½æ›´å¥½**ï¼šä¸éœ€è¦é¢‘ç¹åˆ‡æ¢CSSå±æ€§

### å…·ä½“å®ç°
```javascript
// è®¡ç®—å®¹å™¨å°ºå¯¸çš„å‡½æ•°
const getContainerSize = (fittedSize, rotateDeg) => {
  const radians = rotateDeg * (Math.PI / 180);
  const cos = Math.abs(Math.cos(radians));
  const sin = Math.abs(Math.sin(radians));
  
  const width = fittedSize.width * cos + fittedSize.height * sin;
  const height = fittedSize.width * sin + fittedSize.height * cos;
  
  return {
    width: `${width + 40}px`,  // 40px ç¼“å†²
    height: `${height + 40}px`
  };
};

// ä½¿ç”¨
const containerSize = getContainerSize(fittedSize, rotateDeg);
```

### æ€»ç»“
ç§»é™¤ `overflow: hidden` ä¼šå¸¦æ¥è§†è§‰ã€å¸ƒå±€å’Œäº¤äº’é—®é¢˜ã€‚æ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä¿æŒ `overflow: hidden`ï¼Œä½†åŠ¨æ€è°ƒæ•´å®¹å™¨å°ºå¯¸æ¥é€‚åº”æ—‹è½¬åçš„å›¾ç‰‡ï¼Œè¿™æ ·æ—¢èƒ½è§£å†³"æ¡†"çš„é—®é¢˜ï¼Œåˆèƒ½ä¿æŒæ•´ä½“çš„è§†è§‰æ•ˆæœå’Œå¸ƒå±€ç¨³å®šæ€§ã€‚

## ğŸ¯ æœ€ç»ˆç®€åŒ–æ–¹æ¡ˆï¼šå›å½’æœ¬è´¨éœ€æ±‚

### æ ¸å¿ƒéœ€æ±‚
ç»è¿‡å¤šæ¬¡å°è¯•å’Œè®¨è®ºï¼Œæœ€ç»ˆæ˜ç¡®äº†æ ¸å¿ƒéœ€æ±‚ï¼š
1. **å›¾ç‰‡å¯ä»¥æ—‹è½¬**ï¼šæ¨ªç«–æ—‹è½¬
2. **èƒŒæ™¯ç°è‰²å›ºå®š**ï¼šä¸éšå›¾ç‰‡æ—‹è½¬å˜åŒ–
3. **å°ºå¯¸è§„åˆ™**ï¼šé•¿è¾¹å æ˜¾ç¤ºåŒºåŸŸ 80%ï¼ŒçŸ­è¾¹è‡ªé€‚åº”

### é—®é¢˜æ ¹æº
ä¹‹å‰çš„å®ç°æŠŠç®€å•é—®é¢˜å¤æ‚åŒ–äº†ï¼š
- è£…é¥°æ•ˆæœæ”¾åœ¨å›¾ç‰‡ä¸Šï¼Œå¯¼è‡´è·Ÿç€æ—‹è½¬
- å®¹å™¨å°ºå¯¸åŠ¨æ€å˜åŒ–ï¼Œå¯¼è‡´å¸ƒå±€æ··ä¹±
- è¿‡åº¦è®¾è®¡ï¼Œå¼•å…¥ä¸å¿…è¦çš„å¤æ‚é€»è¾‘

### æœ€ç®€è§£å†³æ–¹æ¡ˆ

```javascript
// 1. è®¡ç®—å›¾ç‰‡å°ºå¯¸ï¼ˆgetFittedSizeAfterRotate å·²ç»å¤„ç†äº† 80% çš„é€»è¾‘ï¼‰
const imageWidth = Math.max(1, Math.round(fittedSize.width));
const imageHeight = Math.max(1, Math.round(fittedSize.height));

// 2. ç®€å•çš„å®¹å™¨ç»“æ„
<div 
  className="relative flex-1 grid place-items-center"
  style={{
    paddingTop: symmetricPadding,
    paddingBottom: symmetricPadding
  }}
>
  {/* ç°è‰²èƒŒæ™¯å®¹å™¨ - å›ºå®šä¸æ—‹è½¬ */}
  <div 
    className="relative rounded-lg shadow-2xl overflow-hidden bg-slate-100"
    style={{
      padding: '20px' // ç»™å›¾ç‰‡ä¸€äº›å†…è¾¹è·
    }}
  >
    {/* å›¾ç‰‡ - åªæ—‹è½¬å›¾ç‰‡æœ¬èº« */}
    <img
      src={photo.size2048 || photo.size1024 || photo.original}
      style={{
        width: `${imageWidth}px`,
        height: `${imageHeight}px`,
        objectFit: 'contain',
        transform: `rotate(${rotateDeg}deg)`,
        transformOrigin: 'center center',
        transition: shouldAnimateRotation ? 'transform 0.2s ease-out' : 'none',
        display: 'block'
      }}
    />
  </div>
</div>
```

### å…³é”®ç‚¹

1. **å¤–å±‚å®¹å™¨**ï¼š
   - ç°è‰²èƒŒæ™¯ `bg-slate-100`
   - åœ†è§’ `rounded-lg`
   - é˜´å½± `shadow-2xl`
   - æº¢å‡ºéšè— `overflow-hidden`
   - **å®¹å™¨ä¸æ—‹è½¬**

2. **å›¾ç‰‡**ï¼š
   - åªæœ‰ `transform: rotate()` åº”ç”¨åœ¨å›¾ç‰‡ä¸Š
   - æ²¡æœ‰è£…é¥°æ•ˆæœï¼ˆåœ†è§’ã€é˜´å½±éƒ½åœ¨å®¹å™¨ä¸Šï¼‰
   - **åªæ—‹è½¬å›¾ç‰‡æœ¬èº«**

3. **å°ºå¯¸è®¡ç®—**ï¼š
   - `getFittedSizeAfterRotate` å·²ç»å¤„ç†äº†é•¿è¾¹ 80% çš„é€»è¾‘
   - ä¸éœ€è¦é¢å¤–çš„åŠ¨æ€å®¹å™¨å°ºå¯¸è®¡ç®—

### ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ‰æ•ˆ

| é—®é¢˜ | è§£å†³æ–¹å¼ |
|------|---------|
| åœ†è§’è·Ÿç€æ—‹è½¬ | åœ†è§’åœ¨å®¹å™¨ä¸Šï¼Œå®¹å™¨ä¸æ—‹è½¬ âœ… |
| é˜´å½±è·Ÿç€æ—‹è½¬ | é˜´å½±åœ¨å®¹å™¨ä¸Šï¼Œå®¹å™¨ä¸æ—‹è½¬ âœ… |
| èƒŒæ™¯è·Ÿç€æ—‹è½¬ | èƒŒæ™¯åœ¨å®¹å™¨ä¸Šï¼Œå®¹å™¨ä¸æ—‹è½¬ âœ… |
| æ—‹è½¬æ—¶æœ‰"æ¡†" | å®¹å™¨æœ‰é€‚å½“å†…è¾¹è·ï¼Œå›¾ç‰‡æœ‰æ—‹è½¬ç©ºé—´ âœ… |
| å°ºå¯¸ä¸å¯¹ | ç›´æ¥ä½¿ç”¨ `fittedSize`ï¼Œå·²ç»æ˜¯ 80% âœ… |

### æ€»ç»“
å›å½’æœ¬è´¨éœ€æ±‚ï¼Œä½¿ç”¨æœ€ç®€å•çš„æ–¹æ¡ˆï¼š
- å®¹å™¨è´Ÿè´£è£…é¥°ï¼ˆèƒŒæ™¯ã€åœ†è§’ã€é˜´å½±ï¼‰ï¼Œä¸æ—‹è½¬
- å›¾ç‰‡è´Ÿè´£æ—‹è½¬ï¼Œä¸å¸¦è£…é¥°
- å°ºå¯¸å·²ç»ç”± `getFittedSizeAfterRotate` æ­£ç¡®è®¡ç®—

è¿™æ˜¯æœ€ç®€å•ã€æœ€ç›´æ¥ã€æœ€æœ‰æ•ˆçš„è§£å†³æ–¹æ¡ˆã€‚
