# /gallery 模块 需求说明（平铺/瀑布流/随机）

版本：v2025-10-30（草案）
状态：待确认

---

## 1. 目标与范围
- 统一展示照片的三种视图：平铺、瀑布流、随机。
- 与 `PhotoPreview`、地图迷你预览等共用能力。

---

## 2. 视图模式

### 2.1 平铺视图
- 标准网格；固定行高/自适应列。
- 分页/懒加载；加载动画与空态；错误提示。

### 2.2 瀑布流视图
- 原生 CSS Grid Masonry；按图片高宽自适配跨度；
- 1px 行高控制 + gap=24；
- 滚动懒加载；首屏骨架屏。

### 2.3 随机模式（胶卷暗盒交互）
- 随机选取胶卷 → 抽取若干照片（5-6张，响应式自适应）。
- 动画：暗盒随机 → 确认 → 胶片带抽出。
- 筛选集成：类型/画幅（与图库筛选一致）。
- 预览：点击任一帧 → 进入 `PhotoPreview`。

---

## 3. 筛选器与参数
- 隐藏加密：默认开启。
- 胶卷类型：彩色负片/黑白/反转。
- 胶卷画幅：135/120/...。
- 查询参数：`film_type`, `film_format`（影响随机筛选）。

---

## 4. 预览与地图
- `PhotoPreview`：支持沉浸模式、旋转、键盘导航；
- 点击地点字段 → 只读迷你地图（zoom=12）。

---

## 5. 分页/加载
- 初始加载与滚动懒加载；
- 错误重试；空态友好文案。

---

## 6. 边界条件
- 未登录仅展示公开照片；
- 加密照片仅在有权限时展示真实资源；
- 随机模式在筛选条件过于狭窄时多次尝试（上限5次）。

---

## 7. 与其他模块联动
- /film：归档后的照片出现在图库；随机模式依赖胶卷数据。
- /map：地图标记点击 → 调用同一 `PhotoPreview`。
- /admin：上传与批量上传影响图库实时性。

---

## 8. API 草案
- GET /api/photos?page&limit&film_type&film_format
- GET /api/filmRolls/random

---

## 9. 验收清单
- 三视图切换稳定；
- 筛选项与数据联动正确；
- 随机模式动画顺滑，抽取照片符合筛选；
- 预览与地图弹窗一致可用；
- 懒加载无抖动与重复。