# /admin 模块 需求说明（管理后台）

版本：v2025-10-30（草案）
状态：待确认

---

## 1. 目标与范围
- 管理照片、胶卷实例与品类、设备、地址；
- 承载 /film 的状态流转动作、工艺库维护与冲洗记录创建；

---

## 2. 模块结构
- 照片管理：上传/批量上传、旋转、元数据编辑（地点统一化）。
- 胶卷实例管理：列表/筛选、状态流转（启封、拍摄完毕、冲洗完成、归档）。
- 胶卷品类管理（film_stocks）：品牌/系列/ISO/类型/格式/图片。
- 设备管理：相机、扫描仪。
- 冲洗：
  - 工艺库（wash_processes）维护；
  - 商家（wash_vendors）维护；
  - 冲洗记录（wash_orders）创建/查询（票号=日期+序号）。
- 地图工具：地址解析、批量坐标补录。

---

## 3. 状态流转表单（与 /film 对齐）
| 动作 | 必填 | 可选 | 校验 |
|---|---|---|---|
| 启封 | opened_date, camera_id | camera_lens, notes | 状态必须为 stock_in |
| 拍摄完毕 | finished_date | notes | 状态必须为 shooting |
| 冲洗完成 | washed_date, wash_process_id, wash_method | wash_vendor_id(third_party必填), wash_notes, push_pull | 状态必须为 pending_wash |
| 归档 | archived_date, scanner_id | scan_resolution, scan_bit_depth, scan_notes | 状态必须为 pending_scan |

---

## 4. 冲洗记录与票号
- 点击“冲洗完成”即创建 `wash_orders` 并生成 ticket_no=YYYY-MM-DD-###；
- 同日编号从 001 递增、唯一；
- 记录与胶卷实例强关联，可从胶卷详情跳转查看。

---

## 5. 边界条件
- 回退/纠错：允许管理员将状态回退（需二次确认与事件记录）。
- 并发：同一胶卷禁止并发提交多次流转（后端幂等/锁）。
- 权限：状态动作与库维护需管理员角色。

---

## 6. 与其他模块联动
- /film：列表展示、统计与时间轴依赖本模块的状态与数据；
- /gallery：上传后的归档照片立即可见；
- /map：坐标修复与批量补录落库后同步生效。

---

## 7. API 草案
- POST /api/filmRolls/:id/open
- POST /api/filmRolls/:id/finish
- POST /api/filmRolls/:id/wash-finish
- POST /api/filmRolls/:id/archive
- CRUD: /api/wash-processes, /api/wash-vendors, /api/wash-orders

---

## 8. 验收清单
- 四个状态动作完整校验；事件日志可追溯；
- 工艺库/商家/冲洗记录维护可用；
- 票号生成规则正确且唯一；
- 回退流程与权限控制生效。