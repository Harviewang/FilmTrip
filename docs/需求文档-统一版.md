# FilmTrip 胶片摄影管理系统 - 需求文档

**版本**: v3.0 统一版  
**创建日期**: 2025-01-21  
**最后更新**: 2025-10-21  
**状态**: 核心功能已实现，持续优化中

---

## 🎯 项目概述

### 项目定位
FilmTrip是一个专业的胶片摄影管理系统，采用三层清晰结构设计，避免层级过深，保持逻辑简单。系统旨在帮助胶片摄影爱好者管理胶卷、照片、相机和扫描仪等资源。

### 核心价值
1. **简化管理流程**：一卷胶卷天然就是一个照片集合，无需额外相册概念
2. **完整信息记录**：从胶卷品类到具体照片的完整信息链
3. **专业摄影支持**：支持EXIF信息、地理位置、评分系统等专业功能
4. **灵活权限控制**：支持公开、私密、链接可见等多种可见性设置

### 目标用户
- **主要用户**：胶片摄影爱好者、专业摄影师
- **次要用户**：摄影工作室、胶片冲洗店
- **管理员**：系统管理员、内容审核员

---

## 🏗️ 核心设计理念

### 1. 三层清晰结构
- **胶卷品类 (Film Stock)** → **胶卷实例 (Film Roll)** → **照片 (Photo)**
- 避免层级过深，保持逻辑简单
- 每层职责明确，易于理解和维护

### 2. 继承关系
- 照片继承胶卷实例的所有属性
- 胶卷实例继承胶卷品类的所有属性
- 减少数据冗余，提高数据完整性

### 3. 实际业务导向
- 一卷胶卷天然就是一个照片集合
- 不需要额外的相册概念
- 符合胶片摄影的实际工作流程

---

## 🎨 核心功能

### 4大浏览模式 ✅ 已实现
1. **照片模式** - 画廊模式 + 瀑布流模式，支持下拉刷新和懒加载
2. **胶卷模式** - 时间轴 + 网格双列布局，包含年份/月度筛选、GitHub 风格热力图、胶片条沉浸浏览与状态切换
3. **地图模式** - 默认 MapTiler 底图，22 级缩放无跳跃，统一 PhotoPreview 组件，自动聚合至街道级精度
4. **随机浏览** - 随机展示单张照片的页面

### 管理功能 ✅ 已实现
- **前台公开**：无需登录浏览
- **后台认证**：管理员登录，JWT认证
- **批量上传**：EXIF自动提取，多尺寸缩略图生成
- **系统管理**：照片管理、胶卷管理、相机管理
- **元数据管理**：支持编辑完整拍摄元数据（国家/省份/城市/地点、相机/镜头参数、曝光信息、分类标签、行程信息）

### 图片预览功能 ✅ 已实现
- **标准模式**：图片80%占比，EXIF信息浮动显示
- **沉浸模式**：图片100%占比，全屏体验
- **旋转功能**：支持连续旋转，每张图片独立状态
- **智能尺寸**：根据图片方向自动调整显示尺寸
- **胶片条预览**：在胶卷模式中以胶片条快速浏览照片，支持键盘导航与实时状态切换

---

## 🆕 近期更新（2025-10）
- **照片元数据增强系统**：新增地理信息、拍摄参数、分类标签、行程信息等字段，提供批量迁移脚本与前端实时编辑体验。
- **胶卷时间轴 2.0**：整合年份/月度筛选、无限滚动分页、GitHub 风格热力图、胶片条沉浸浏览与状态切换。
- **地图视图稳定化**：默认使用 MapTiler `dataviz` 样式，提供 3–22 级顺滑缩放与统一的照片预览，供应商自动回退链为 MapTiler → OSM → AMap → Carto。
- **统计接口扩展**：新增 `/stats/activity/heatmap` 等 API，为前端热力图与仪表板提供数据基础。

---

## 🏗️ 技术架构

### 当前技术栈
- **前端**：React 18 + Vite + Tailwind CSS
- **后端**：Node.js + Express + SQLite
- **图片处理**：Sharp (EXIF处理、多尺寸生成)
- **部署**：Vercel + 自定义域名

### 数据模型
```
胶卷品类 (Film Stock) 1:N
    ↓
胶卷实例 (Film Roll) 1:N
    ↓  
照片 (Photo)
```

### 核心表结构
- **film_stocks**：胶卷品类信息（品牌、系列、类型、ISO、备注）
- **film_rolls**：胶卷实例信息（胶卷编号、拍摄时间范围、状态、所属行程、关联照片数）
- **photos**：照片信息与元数据（地理信息：country/province/city/location_name；拍摄参数：camera_model、lens_model、lens_focal_length、exposure_compensation、metering_mode、focus_mode；分类标签：categories；行程信息：trip_name、trip_start_date、trip_end_date）
- **cameras**：相机设备信息
- **scanners**：扫描仪设备信息
- **统计接口（派生数据）**：基于 photos/film_rolls 生成的活跃热度、趋势、仪表板统计数据

---

## ⚡ 性能要求

### 响应时间要求
- **首页加载**：<2秒（桌面端，100Mbps网络）
- **照片打开**：<1秒（单张图片，1MB以内）
- **模式切换**：<500ms
- **图片加载**：<3秒（包含所有资源）

### 并发性能要求
- **同时在线用户**：100人
- **并发操作**：50个并发请求
- **峰值处理**：支持200%的峰值负载

---

## 🎨 设计风格

### 设计原则
- **现代化UI**：简洁、美观、易用
- **一致性**：统一的视觉语言和交互模式
- **专业性**：符合摄影行业的专业感
- **中文优先**：完全中文化，符合国内用户习惯

### 响应式设计
- **桌面端**：1920x1080及以上分辨率优化
- **平板端**：768x1024分辨率适配
- **手机端**：375x667及以上分辨率适配
- **触摸友好**：支持触摸操作和手势

---

## 📱 前端页面结构与交互规则

### 页面架构设计
```
/ (根路径)
├── /photos          # 照片浏览页面（画廊/瀑布流模式）
├── /filmrolls       # 胶卷时间轴页面
├── /map             # 地图视图页面
├── /random          # 随机浏览页面
├── /more            # 更多功能页面
└── /admin/*         # 管理后台（需要登录）
    ├── /admin/dashboard     # 仪表板
    ├── /admin/photos        # 照片管理
    ├── /admin/film-stocks   # 胶卷品类管理
    ├── /admin/film-rolls    # 胶卷实例管理
    ├── /admin/cameras       # 相机管理
    └── /admin/scanners      # 扫描仪管理
```

### 交互规则设计
- **照片展示**：点击照片显示浮层预览，不跳转页面
- **预览功能**：支持标准模式和沉浸模式切换
- **旋转功能**：每张图片独立保持旋转状态
- **返回导航**：保持用户的筛选条件和浏览位置

---

## ✅ 功能实现状态

### 已完成功能 ✅
- [x] 用户认证系统（JWT）
- [x] 照片上传和管理
- [x] 胶卷品类管理
- [x] 胶卷实例管理
- [x] 相机管理
- [x] 扫描仪管理
- [x] 照片预览功能（标准/沉浸模式）
- [x] 图片旋转功能
- [x] 照片元数据增强系统（地理信息、拍摄参数、分类标签、行程信息）
- [x] MapTiler 地图视图优化（22 级缩放、统一预览、供应商优先级）
- [x] 胶卷时间轴 2.0（年份筛选、热力图、胶片条状态管理）
- [x] 瀑布流布局
- [x] 画廊模式布局
- [x] 响应式设计
- [x] 云端部署

### 进行中功能 🔄
- [ ] 时间轴视图性能优化（移动端、预加载）
- [ ] 统计仪表板
- [ ] 性能优化

### 计划中功能 ⏳
- [ ] 照片页第三种展示模式：在 Photos 页面集成“随机”浏览，与平铺/瀑布流形成三视图
- [ ] “旅途”入口改版为“地点”，统一文案与导航
- [ ] 新增一级入口（旅途/标签视角），以旅程或标签为组织方式重新分类胶卷与照片
- [ ] 社交分享功能（朋友圈/微博文案与样式）
- [ ] 智能推荐系统
- [ ] 高级筛选功能
- [ ] 数据统计分析

### 需求池（待规划）
**体验与性能优化**
- [ ] 静态资源 CDN 管理：统一配置图片/脚本分发与缓存策略
- [ ] 图片懒加载全面优化（含列表、胶片条、地图预览）
- [ ] 上传时支持手动/批量编辑图片元数据
- [ ] 图片加水印能力（批量/可选）
- [ ] 多版本水印策略：上传后生成带水印分享图与无水印缩略图，按场景选择加载
- [ ] 加密机制升级：新增独立加密字段与类型枚举（如肖像/敏感信息/其他），支持批量管理

**内容与社交能力**
- [ ] 发布更新日志，记录每次发版内容
- [ ] 社交分享快捷入口与自定义分享样式（含 icon、文案）
- [ ] 分享图生成：导出包含留白、详情、二维码的图片
- [ ] 评论功能（照片/胶卷留言、回复、管理）
- [ ] 照片与胶卷评分体系（支持评分，显示平均分与评分人数）
- [ ] 短链接服务：为照片/胶卷生成 camarts.cn 样式的短链，例如 `https://camarts.cn/wx9`
- [ ] 故事/旅程视图：按旅程或标签聚合作品与胶卷，形成专题故事模式

**智能化能力**
- [ ] 人脸识别与人物聚合

**产品形态扩展**
- [ ] 胶卷全生命周期管理，每卷胶卷拥有独立主页
- [ ] H5 端体验适配与交互设计
- [ ] 小程序/移动端轻应用版本
- [ ] 跨多端音乐播放器，提供沉浸式观展体验（后续规划）

**知识与运营支持**
- [ ] 冲洗工艺管理模块（流程记录、参数追踪、成果复盘）
- [ ] 冲洗工艺速查手册（工艺知识库、常见问题及最佳实践）
- [ ] 曝光笔记与冲洗笔记模块（记录拍摄/冲洗过程，低优先级）

---

## 📊 验收标准

### 功能完整性
- 所有核心功能正常工作
- 用户界面友好易用
- 数据管理准确可靠

### 性能指标
- 响应时间满足要求
- 支持预期并发用户数
- 系统稳定运行

### 用户体验
- 用户操作流程顺畅
- 界面美观易用
- 功能满足用户需求

---

## 🚀 开发优先级

### P0 (必须) ✅ 已完成
- 4大核心浏览模式
- 后台管理认证
- 基础数据管理

### P1 (重要) 🔄 进行中
- 时间轴视图性能优化
- 性能优化
- 统计仪表板（含活跃热力图、胶卷进度统计）

### P2 (可选) ⏳ 计划中
- 社交分享功能
- 智能推荐系统
- 高级筛选功能

---

## 📝 相关文档

- **[开发日志](./开发日志.md)** - 开发过程记录和问题追踪
- **[部署指南](./部署指南.md)** - 部署与运维说明
- **[项目规范总览](./项目规范总览.md)** - 团队协作与代码规范
- **[地图照片分布展示方案](./地图照片分布展示方案.md)** - 地图交互与实现方案
- **[前端设计规范](./前端设计规范.md)** - UI 与组件规范

---

*本文档详细描述了业务需求、功能规格、界面要求等，为开发团队提供完整的指导。如有疑问或需要进一步细化，请联系项目负责人。*
