# FilmTrip 数据库设计文档

## 设计原则

### 1. 三层清晰结构
- 避免层级过深，保持逻辑简单
- 每层职责明确，易于理解和维护
- 通过外键关联，确保数据一致性

### 2. 继承关系
- 照片继承胶卷实例的所有属性
- 胶卷实例继承胶卷品类的所有属性
- 减少数据冗余，提高数据完整性

### 3. 实际业务导向
- 一卷胶卷天然就是一个照片集合
- 不需要额外的相册概念
- 符合胶片摄影的实际工作流程

## 实体关系图

```
胶卷品类 (Film Stock)
    ↓ (1:N)
胶卷实例 (Film Roll) 
    ↓ (1:N)  
照片 (Photo)

相机 (Camera) ←→ 胶卷实例 (Film Roll)
扫描仪 (Scanner) ←→ 胶卷实例 (Film Roll)
```

## 详细表结构

### 1. 胶卷品类表 (film_stocks)

**用途**：存储所有胶卷的基础信息，所有同型号胶卷共享

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | TEXT | 主键，UUID | `uuid-v4` |
| `brand` | TEXT | 品牌名称 | `Kodak`, `富士`, `柯达` |
| `series` | TEXT | 系列名称 | `Gold`, `Provia`, `Portra` |
| `iso` | INTEGER | ISO感光度 | `200`, `100`, `400` |
| `format` | TEXT | 胶卷规格 | `135mm`, `120`, `4x5` |
| `type` | TEXT | 胶卷类型 | `彩色负片`, `黑白负片`, `彩色正片` |
| `description` | TEXT | 描述信息 | `适合人像摄影` |
| `created_at` | TIMESTAMP | 创建时间 | `2025-01-21 10:00:00` |
| `updated_at` | TIMESTAMP | 更新时间 | `2025-01-21 10:00:00` |

**示例数据**：
```sql
INSERT INTO film_stocks VALUES (
  'uuid-1', 'Kodak', 'Gold', 200, '135mm', '彩色负片', 
  '经典彩色负片，适合日常摄影', '2025-01-21 10:00:00', '2025-01-21 10:00:00'
);
```

### 2. 胶卷实例表 (film_rolls)

**用途**：存储具体的一卷胶卷，继承胶卷品类属性，添加实例特有属性

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | TEXT | 主键，UUID | `uuid-v4` |
| `film_stock_id` | TEXT | 胶卷品类ID | `uuid-1` |
| `roll_number` | TEXT | 胶卷编号（唯一） | `A0001`, `B0002` |
| `name` | TEXT | 胶卷名称 | `8月旅行第一卷` |
| `opened_date` | TEXT | 启封时间 | `2025-08-01` |
| `location` | TEXT | 拍摄位置 | `广东省深圳市` |
| `camera_id` | TEXT | 拍摄相机ID | `camera-uuid` |
| `developed_date` | TEXT | 冲洗时间 | `2025-08-05` |
| `developer` | TEXT | 冲洗商家 | `某家冲洗店` |
| `development_method` | TEXT | 冲洗手法 | `标准C-41` |
| `scanner_id` | TEXT | 扫描仪ID | `scanner-uuid` |
| `is_encrypted` | BOOLEAN | 是否加密 | `0` |
| `status` | TEXT | 胶卷状态 | `未启封/拍摄中/已冲洗/已扫描` |
| `notes` | TEXT | 备注信息 | `拍摄注意事项` |
| `created_at` | TIMESTAMP | 创建时间 | `2025-01-21 10:00:00` |
| `updated_at` | TIMESTAMP | 更新时间 | `2025-01-21 10:00:00` |

**示例数据**：
```sql
INSERT INTO film_rolls VALUES (
  'roll-uuid-1', 'uuid-1', 'A0001', '8月旅行第一卷',
  '2025-08-01', '广东省深圳市', 'camera-uuid', '2025-08-05',
  '某家冲洗店', '标准C-41', 'scanner-uuid', 0, '已扫描',
  '拍摄注意事项', '2025-01-21 10:00:00', '2025-01-21 10:00:00'
);
```

### 3. 照片表 (photos)

**用途**：存储具体照片，继承胶卷实例的所有属性，添加照片特有属性

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | TEXT | 主键，UUID | `uuid-v4` |
| `film_roll_id` | TEXT | 胶卷实例ID | `roll-uuid-1` |
| `photo_number` | INTEGER | 照片序号 | `1`, `2`, `...`, `36` |
| `filename` | TEXT | 保存的文件名 | `uuid-photo.jpg` |
| `original_name` | TEXT | 原始文件名 | `DSC00384.JPG` |
| `title` | TEXT | 照片标题 | `深圳湾日落` |
| `description` | TEXT | 照片描述 | `美丽的日落景色` |
| `taken_date` | TEXT | 拍摄日期 | `2025-08-03` |
| `camera_id` | TEXT | 拍摄相机ID | `camera-uuid` |
| `aperture` | TEXT | 光圈值 | `f/2.8` |
| `shutter_speed` | TEXT | 快门速度 | `1/125s` |
| `focal_length` | TEXT | 焦距 | `50mm` |
| `iso` | INTEGER | ISO感光度 | `200` |
| `latitude` | REAL | GPS纬度 | `22.5431` |
| `longitude` | REAL | GPS经度 | `114.0579` |
| `location_name` | TEXT | 拍摄地点 | `深圳湾公园` |
| `rating` | INTEGER | 评分（1-5） | `5` |
| `is_encrypted` | BOOLEAN | 是否加密 | `0` |
| `tags` | TEXT | 标签（逗号分隔） | `日落,风景,深圳` |
| `uploaded_at` | TIMESTAMP | 上传时间 | `2025-01-21 10:00:00` |
| `updated_at` | TIMESTAMP | 更新时间 | `2025-01-21 10:00:00` |

**示例数据**：
```sql
INSERT INTO photos VALUES (
  'photo-uuid-1', 'roll-uuid-1', 1, 'uuid-photo.jpg', 'DSC00384.JPG',
  '深圳湾日落', '美丽的日落景色', '2025-08-03', 'camera-uuid',
  'f/2.8', '1/125s', '50mm', 200, 22.5431, 114.0579, '深圳湾公园',
  5, 0, '日落,风景,深圳', '2025-01-21 10:00:00', '2025-01-21 10:00:00'
);
```

### 4. 相机表 (cameras)

**用途**：存储相机设备信息

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | TEXT | 主键，UUID | `uuid-v4` |
| `name` | TEXT | 相机名称 | `佳能EOS KISS` |
| `model` | TEXT | 相机型号 | `EOS Kiss` |
| `brand` | TEXT | 相机品牌 | `Canon` |
| `type` | TEXT | 相机类型 | `单反相机` |
| `format` | TEXT | 支持画幅 | `135mm` |
| `description` | TEXT | 描述信息 | `入门级单反相机` |
| `created_at` | TIMESTAMP | 创建时间 | `2025-01-21 10:00:00` |
| `updated_at` | TIMESTAMP | 更新时间 | `2025-01-21 10:00:00` |

### 5. 扫描仪表 (scanners)

**用途**：存储扫描仪设备信息

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | TEXT | 主键，UUID | `uuid-v4` |
| `name` | TEXT | 扫描仪名称 | `爱普生V850` |
| `model` | TEXT | 扫描仪型号 | `V850 Pro` |
| `type` | TEXT | 扫描仪类型 | `平板扫描仪` |
| `description` | TEXT | 描述信息 | `专业胶片扫描仪` |
| `created_at` | TIMESTAMP | 创建时间 | `2025-01-21 10:00:00` |
| `updated_at` | TIMESTAMP | 更新时间 | `2025-01-21 10:00:00` |

## 外键关系

### 1. 胶卷实例 → 胶卷品类
```sql
FOREIGN KEY (film_stock_id) REFERENCES film_stocks(id)
```

### 2. 照片 → 胶卷实例
```sql
FOREIGN KEY (film_roll_id) REFERENCES film_rolls(id)
```

### 3. 胶卷实例 → 相机
```sql
FOREIGN KEY (camera_id) REFERENCES cameras(id)
```

### 4. 胶卷实例 → 扫描仪
```sql
FOREIGN KEY (scanner_id) REFERENCES scanners(id)
```

### 5. 照片 → 相机
```sql
FOREIGN KEY (camera_id) REFERENCES cameras(id)
```

## 数据查询示例

### 1. 获取一卷胶卷的所有照片
```sql
SELECT p.*, fr.name as roll_name, fs.brand, fs.series, fs.iso
FROM photos p
JOIN film_rolls fr ON p.film_roll_id = fr.id
JOIN film_stocks fs ON fr.film_stock_id = fs.id
WHERE fr.id = 'roll-uuid-1'
ORDER BY p.photo_number;
```

### 2. 获取所有Kodak胶卷
```sql
SELECT * FROM film_stocks WHERE brand = 'Kodak';
```

### 3. 获取某台相机拍摄的所有照片
```sql
SELECT p.*, fr.roll_number, fr.name as roll_name
FROM photos p
JOIN film_rolls fr ON p.film_roll_id = fr.id
WHERE p.camera_id = 'camera-uuid';
```

## 索引建议

### 1. 主键索引
- 所有表的 `id` 字段自动创建主键索引

### 2. 外键索引
```sql
CREATE INDEX idx_film_rolls_stock_id ON film_rolls(film_stock_id);
CREATE INDEX idx_photos_roll_id ON photos(film_roll_id);
CREATE INDEX idx_film_rolls_camera_id ON film_rolls(camera_id);
CREATE INDEX idx_film_rolls_scanner_id ON film_rolls(scanner_id);
CREATE INDEX idx_photos_camera_id ON photos(camera_id);
```

### 3. 查询优化索引
```sql
CREATE INDEX idx_film_rolls_roll_number ON film_rolls(roll_number);
CREATE INDEX idx_photos_taken_date ON photos(taken_date);
CREATE INDEX idx_photos_rating ON photos(rating);
CREATE INDEX idx_film_stocks_brand_series ON film_stocks(brand, series);
```

## 数据完整性约束

### 1. 非空约束
- `film_stocks`: brand, series, iso, format, type
- `film_rolls`: film_stock_id, roll_number, name
- `photos`: film_roll_id, filename, original_name
- `cameras`: name, model
- `scanners`: name, model

### 2. 唯一约束
- `film_rolls.roll_number`: 胶卷编号必须唯一
- `users.username`: 用户名必须唯一

### 3. 默认值
- `is_encrypted`: 默认 `0` (false)
- `status`: 默认 `'未启封'`
- `rating`: 默认 `0`
- `created_at`, `updated_at`: 自动设置当前时间

## 扩展性考虑

### 1. 未来可能添加的字段
- `film_stocks`: 保质期、价格、库存等
- `film_rolls`: 拍摄张数限制、剩余张数等
- `photos`: 更多EXIF信息、白平衡、GPS等

### 2. 性能优化
- 考虑分表：按时间或胶卷实例分表
- 缓存策略：胶卷品类信息缓存
- 图片存储：考虑CDN或云存储

### 3. 功能扩展
- 用户权限管理
- 数据导入导出
- 备份恢复机制
- 统计分析功能
