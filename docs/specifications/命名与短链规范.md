# FilmTrip 命名与短链规范（v1.4）

- **最后更新**：2025-11-12  
- **维护者**：产品团队 & AI 助手  
- **关联讨论**：`docs/archive/临时文档/filmtrip-naming-v1.4.md`

---

## 1. 适用范围

本规范约束 FilmTrip 项目中 **胶卷品类（Film Stock）→ 胶卷实例（Film Roll）→ 照片（Photo）** 三层实体在以下方面的统一策略：

- 数据库主键与业务编号  
- Short Code 短链生成与解析  
- URL/分享链接路由规划  
- 文件命名与对象存储目录结构  
- 去重、版本管理与权限策略

规范设计目标：

1. **语义清晰**：业务编号可读、短链易记。  
2. **全局唯一**：不同层级均具备唯一短码，避免冲突。  
3. **分享友好**：统一短链入口，便于外部传播。  
4. **可扩展性**：支持数百万级文件存储与热点缓存。  
5. **安全可控**：原始文件与对外版本解耦，便于权限管理。

---

## 2. 层级与字段定义

| 层级 | 主键 | 业务编号（code） | 短码（short，Base62） | 是否人工命名 | 唯一性 | 说明 |
|------|------|------------------|------------------------|--------------|--------|------|
| **Film（胶卷品类）** | `id`（自增） | ✅ 例如 `KD-G200-135` | ✅ 2 位（例 `aZ`） | 自动生成 | 值唯一 | 品牌+系列+ISO+画幅 |
| **Roll（胶卷实例）** | `id`（自增） | ❌ | ✅ 3 位（例 `vn6`） | 自动生成 | 值唯一 | 具体一卷胶卷 |
| **Frame（照片）** | `uuid` | ❌ | ✅ 5 位（例 `aZ3kQ`） | 自动生成 | 值唯一 | 对应单张照片文件 |

> Base62 字符集为 `0-9 a-z A-Z`，短码不回收、不复用，保证历史链接永久有效。

---

## 3. 业务编号规则

### 3.1 Film 编号（code）

```
{BRAND2}-{SER1}{ISO}-{FORMAT}
```

- `BRAND2`：品牌首字母缩写（Kodak → `KD`、Fujifilm → `FJ`、Ilford → `IL` 等）。  
- `SER1`：系列首字母（Gold → `G`、Portra → `P`、HP5 → `H`）。  
- `ISO`：感光度，如 `200`、`400`。  
- `FORMAT`：画幅（135 / 120 / 220 / 4x5 / APS 等）。

示例：`KD-G200-135` → Kodak Gold 200, 135 胶卷。

### 3.2 Roll 与 Frame

- 不额外声明业务编号，统一依赖短码与主键。
- 若需要人工备注，可提供 `display_name` 字段，仅用于描述，不参与唯一性。

---

## 4. 短链与路由策略

### 4.1 统一入口

FilmTrip 的所有短链均挂载在站点根路径，根据短码长度区分层级：

| 层级 | 短码长度 | 示例短链 | 打开内容 |
|------|-----------|----------|-----------|
| Film | 2 | `/aZ` | 胶卷品类详情页 |
| Roll | 3 | `/vn6` | 该卷胶卷页面 |
| Frame | 5 | `/aZ3kQ` | 照片预览浮层 |

### 4.2 匹配与导航

1. 先匹配保留路径（`/gallery`、`/timeline`、`/map`、`/film-rolls`、`/api/*` 等）。  
2. 其余根路径按长度进入短链解析逻辑。  
3. 各模块在进入预览模式时统一 `