# 随机浏览功能需求澄清记录（详细版）

## 📅 日期
2025-10-24

## 🎯 需求背景
用户对随机浏览功能的交互设计和实现方案提出了详细要求，需要记录并整理到知识库中。

## 🔍 详细需求分析

### 1. 视觉设计需求

#### 胶卷样式设计
- **整体布局**：左边一个胶卷罐，右边拉出来一段胶卷
- **背景颜色**：黑底
- **装饰元素**：上下有齿轮样式
- **显示数量**：一次拉出来5-6张图片
- **屏幕适配**：保持在一屏显示
- **响应式**：根据分辨率调整，宽度不够可以竖着显示

#### 胶卷规格
- **尺寸固定**：胶卷的长宽都是固定的
- **方向处理**：通过EXIF中存的方向自动旋转图片，保持同样的方向
- **参考图片**：用户将提供参考图片

### 2. 交互逻辑需求

#### 方案选择
**采纳方案2**：
- 先随机胶卷罐，确定是哪一卷
- 然后从该卷抽取5-6张图片
- **原因**：后面会涉及不同格式的胶卷，全局随机难以统一

#### 动画效果
- **刷新时**：收进去再拉出
- **首次打开**：直接拉出
- **交互流程**：点击刷新/随机按钮 → 收进去 → 拉出新的胶卷

#### 按钮位置
- **选项1**：页面右上角
- **选项2**：胶卷拉出来的右侧卷头

### 3. 功能需求

#### 数据过滤
- **加密过滤**：照片需要过滤加密的
- **权限控制**：普通用户不能看到加密照片

#### 页面集成
- **统一逻辑**：随机页面应遵循Gallery页面统一的逻辑
- **左侧**：三种展现形式（平铺、瀑布流、随机）
- **右侧**：筛选功能
  - 隐藏加密图片
  - 胶卷类型筛选（彩色、黑白、反转等）
  - 胶卷画幅筛选（135、120等）

### 4. 技术实现需求

#### 数据库改造
- **胶卷参数**：需要同步改造胶卷数据，添加缺失参数
- **包装照片**：胶卷的包装照片
- **暗盒照片**：胶卷暗盒（胶卷罐）的照片

#### API接口
- **随机胶卷**：`/api/filmRolls/random`
- **胶卷照片**：`/api/photos?film_roll_id=X&limit=5-6&sort=random`
- **过滤加密**：确保返回的照片不包含加密内容

## 📋 实现计划

### 阶段1: 数据准备
- [ ] 确认胶卷数据包含包装照片和暗盒照片
- [ ] 验证随机胶卷API返回完整信息
- [ ] 测试照片过滤逻辑

### 阶段2: UI设计
- [ ] 设计胶卷罐样式（左侧）
- [ ] 设计胶卷拉出效果（右侧）
- [ ] 实现齿轮装饰效果
- [ ] 添加动画效果（收进去→拉出）

### 阶段3: 交互实现
- [ ] 实现5-6张照片的展示
- [ ] 实现EXIF方向自动旋转
- [ ] 实现响应式布局（横屏/竖屏）
- [ ] 集成Gallery页面统一逻辑

### 阶段4: 功能完善
- [ ] 添加刷新按钮（两个位置选项）
- [ ] 实现加密照片过滤
- [ ] 集成筛选功能
- [ ] 优化动画效果

## 🎯 验收标准

### 视觉验收
- [ ] 胶卷样式符合设计要求
- [ ] 齿轮装饰效果正确
- [ ] 黑底背景实现
- [ ] 响应式布局正常

### 交互验收
- [ ] 动画效果流畅（收进去→拉出）
- [ ] 首次打开直接拉出
- [ ] 刷新按钮功能正常
- [ ] 照片方向自动旋转

### 功能验收
- [ ] 随机胶卷逻辑正确
- [ ] 照片数量5-6张
- [ ] 加密照片已过滤
- [ ] 筛选功能集成正常

## 💡 技术要点

### 1. 胶卷样式实现
```css
/* 胶卷罐样式 */
.film-canister {
  width: 120px;
  height: 80px;
  background: linear-gradient(45deg, #333, #666);
  border-radius: 8px;
}

/* 胶卷拉出效果 */
.film-strip {
  background: #000;
  padding: 20px 0;
  position: relative;
}

/* 齿轮装饰 */
.gear-pattern {
  background-image: repeating-linear-gradient(
    90deg,
    transparent,
    transparent 2px,
    #666 2px,
    #666 4px
  );
}
```

### 2. 动画效果
```javascript
// 收进去动画
const rollIn = () => {
  // 胶卷收进胶卷罐
};

// 拉出动画
const rollOut = () => {
  // 胶卷从胶卷罐拉出
};
```

### 3. EXIF方向处理
```javascript
// 根据EXIF方向旋转图片
const rotateImage = (image, orientation) => {
  const rotations = {
    1: 0,
    3: 180,
    6: 90,
    8: 270
  };
  return rotations[orientation] || 0;
};
```

## 📚 相关文档
- `docs/需求文档-统一版.md` - 随机模式交互优化
- `docs/work-plans/2025-10-24/随机交互需求澄清记录.md` - 基础澄清记录
- `docs/knowledge-base/refactoring-guides/组件重构-Photos到Gallery.md` - 组件重构记录

## 🔄 后续行动
1. **等待参考图片**：用户提供胶卷样式参考图片
2. **确认按钮位置**：确定刷新按钮的最终位置
3. **开始实现**：按照需求逐步实现功能
4. **定期沟通**：确保实现符合用户期望

---

**记录人**: AI Assistant  
**状态**: 待实现  
**优先级**: P0  
**类型**: 用户需求澄清
