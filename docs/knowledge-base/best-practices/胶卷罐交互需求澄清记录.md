# 胶卷罐交互需求澄清记录

**创建日期**：2025-10-24  
**更新日期**：2025-10-24  
**需求来源**：用户详细反馈  
**状态**：需求澄清完成

## 📋 需求背景

用户对随机浏览功能提出了全新的"胶片暗盒"交互需求，希望实现真正的胶片暗盒交互效果，而不是简单的照片展示。

## 🎯 核心需求

### 1. **胶片暗盒设计**
- **统一形状**：左侧使用统一的胶片暗盒形状（圆柱形暗盒）
- **动态图片**：胶片暗盒的主体颜色/图片从`film_stock`的`package_image`获取
- **默认状态**：默认加载通用胶片暗盒形状，不显示具体胶卷图片

### 2. **胶卷抽出交互**
- **抽出方向**：
  - 桌面端：水平向右抽出
  - 移动端：垂直向下抽出
- **抽出数量**：
  - 固定5张（或根据页面宽度自适应）
  - 一次性抽出若干张图片
- **片头设计**：胶卷收进胶卷罐中，只保留一个片头

### 3. **交互流程**
**阶段1：默认状态**
- 加载默认的通用胶片暗盒形状
- 胶卷完全收进胶片暗盒中
- 只显示片头，不加载胶片暗盒图片

**阶段2：触发随机**
- 根据Gallery的筛选状态（隐藏加密、胶卷类型、胶卷画幅）
- 先随机选择胶片暗盒（从`film_stock`获取`package_image`）
- 加载胶卷的包装图片到胶片暗盒
- 然后抽出胶卷，一次性抽出5张图片
- 加载并显示这5张图片

### 4. **技术实现要点**
- **胶片暗盒状态管理**：
  - `canisterState`: 'closed' | 'opening' | 'open'
  - `currentFilmStock`: 当前选中的胶卷信息
  - `packageImage`: 胶卷包装图片URL
- **动画效果**：
  - 胶片暗盒打开动画
  - 胶卷抽出动画
  - 图片加载动画
- **响应式设计**：
  - 桌面端：水平抽出
  - 移动端：垂直抽出
- **筛选集成**：
  - 随机选择时考虑当前筛选条件
  - 确保选中的胶卷符合筛选要求

### 5. **视觉设计**
- **胶片暗盒**：统一的圆柱形暗盒，顶部和底部有盖子
- **胶卷条**：深灰色，上下有矩形齿孔
- **片头**：圆润的缺口形状，用于引导
- **图片帧**：5个图像帧区域，显示实际照片
- **背景**：黑色背景，突出胶卷效果

## 🔧 技术实现方案

### 1. **状态管理**
```javascript
const [canisterState, setCanisterState] = useState('closed'); // closed, opening, open
const [currentFilmStock, setCurrentFilmStock] = useState(null);
const [packageImage, setPackageImage] = useState(null);
const [filmPhotos, setFilmPhotos] = useState([]);
const [isLoading, setIsLoading] = useState(false);
```

### 2. **API调用流程**
```javascript
// 1. 根据筛选条件获取随机胶卷
const randomFilmRoll = await fetchRandomFilmRoll(filters);

// 2. 获取胶卷包装图片
const packageImage = randomFilmRoll.film_stock.package_image;

// 3. 从该胶卷获取随机照片
const photos = await fetchRandomPhotos(randomFilmRoll.id, 5);
```

### 3. **动画实现**
- 使用CSS动画或Framer Motion
- 胶片暗盒打开：旋转或滑动效果
- 胶卷抽出：从右到左（桌面）或从上到下（移动端）
- 图片加载：渐入效果

## ✅ 验收标准

### 1. **功能验收**
- [ ] 默认状态显示通用胶片暗盒，胶卷完全收进
- [ ] 点击随机按钮触发胶片暗盒打开动画
- [ ] 根据筛选条件随机选择胶卷
- [ ] 加载胶卷包装图片到胶片暗盒
- [ ] 胶卷抽出动画，显示5张图片
- [ ] 移动端垂直抽出，桌面端水平抽出
- [ ] 图片根据EXIF自动旋转

### 2. **交互验收**
- [ ] 胶片暗盒状态切换流畅
- [ ] 抽出动画自然
- [ ] 图片加载不卡顿
- [ ] 筛选条件正确应用
- [ ] 响应式设计适配

### 3. **视觉验收**
- [ ] 胶片暗盒形状统一
- [ ] 胶卷条有齿孔效果
- [ ] 片头形状正确
- [ ] 黑色背景突出效果
- [ ] 图片方向正确

## 📝 后续行动

1. **更新需求澄清记录**：根据用户最新反馈更新
2. **技术方案设计**：详细设计胶片暗盒交互方案
3. **动画效果实现**：实现胶片暗盒打开和抽出动画
4. **响应式适配**：确保移动端和桌面端效果
5. **筛选集成**：确保随机选择考虑筛选条件
6. **测试验证**：全面测试交互效果

## 🧭 沟通与对齐准则（保障构想 = 最终成品）

1. **先画后写**  
   - 每次迭代先提供低/中保真草图（纸笔或 Figma），用红色标注动态部分。  
   - 关键帧动画用 3～5 张步骤草图说明（展开→抽出→停驻），比文字更易被 Cursor 理解。

2. **需求模板统一**  
   - 在 summary 或 PR 描述中使用固定结构：`目标 → 关键信息 → 约束 → 验收清单 → 反例`。  
   - 反例里写清楚“不希望看到的效果”（例如不需要灯光动画、不需要无穷循环等）。

3. **交互脚本化**  
   - 采用「用户操作→界面响应→状态变化」三列脚本，Cursor 读起来像流程图，减少误解。  
   - 用 `state.before` / `state.after` 说明关键变量（如 `canisterState`、`currentFrameIndex`）。

4. **设计 Token 与尺寸表**  
   - 在文档或 `.ts` 配置中列出颜色、间距、胶卷宽高、帧宽、齿孔尺寸等常量，避免 AI 自行猜测。  
   - 需要特殊比例时给出公式：`frameWidth = containerWidth * 0.22` 等。

5. **动画验收要点提前写死**  
   - 明确动画时长、缓动函数、延迟触发条件，并辅以 GIF/视频参考。  
   - 若暂时无法提供动效素材，可指定「采用 CSS transition 版本」的兜底方案。

6. **与 Cursor 协作的节奏**  
   - 先让 Cursor 输出「理解确认」：要求它用自己的话复述需求，并列出将创建/修改的文件列表。  
   - 每完成一小节（例如“胶卷壳体布局”）先自测再继续，避免一次生成过多代码。

7. **验收 Checklist**  
   - 开发结束前让 Cursor 对照验收条目逐项勾选并给出截图/描述。  
   - 保留关键状态的截图或录屏，后续回归时可复用，防止体验退化。

> 以上准则适用于 `/gallery` 随机模式所有交互迭代，落地前务必附在需求描述或评论中，让 Cursor 能在同一语境下工作。

## 🎞️ 新增细化说明（2025-10-24 用户回访）

### 页面主旨
- 随机模式仅负责“抽取胶卷并展示若干照片”，点击任意帧直接交给全局 `PhotoPreview` 处理预览/详情，不在随机组件内重复实现信息面板。
- 布局仅包含两个主体：
  1. **左侧胶卷暗盒**
  2. **右侧胶片带**（含片头与若干帧）
- 整体背景保持与 Gallery 其他视图一致，无需额外的深色背景或卡片容器。

### 胶卷暗盒状态机
1. **初始状态**  
   - 不指定画幅、类型；默认通用外观，无包装贴图。  
   - 胶片完全收纳，仅露出片头的圆角形态。
2. **随机状态**  
   - 触发随机时暗盒进入“抽选”动画，可以参考老虎机的轮播效果，让不同胶卷包装贴图在暗盒身上滚动，强化“随机抽取”感。  
   - 此阶段仍未抽出胶片，暗盒占据左侧固定位置。
3. **确定状态**  
   - 随机结果确定后，暗盒显示对应胶卷的包装贴图/基本信息，同时右侧胶片带渐进式抽出并停留在展示状态。

### 胶片带状态
1. **未抽出**  
   - 仅显示片头（光滑/磨砂质感），可带有胶片品牌 Logo 或“Pull to view”提示。
2. **抽出状态**  
   - 片头在前，其后是胶片主体，顶部与底部均有等距齿孔。  
   - 胶片型号文字显示在胶片条内（具体排版待提供视觉稿后补充）。  
   - 图片帧数量固定（建议 4～6 张）；每帧尺寸一致。
   - 需要根据 EXIF Orientation 统一旋转方向，使所有帧呈现相同的宽高比（默认横向展示）。旋转在拉出胶片时完成，避免帧内出现倒置/竖图。
   - 点击帧 -> 直接调用通用预览组件。

### 互动要点
- “换一卷”= 暗盒回收胶片 → 进入随机状态 → 确定状态 → 抽出新胶卷。整个流程需串联状态机，避免视觉突兀。
- 随机过程中按需阻止重复触发，提供轻量提示（如按钮 loading 态）。
- 如未匹配到可展示照片（例如全部加密被过滤），需提示用户并恢复到初始状态。

### 待补充素材
- 胶片型号文字、齿孔精细样式、片头设计等将由用户提供实例图后再迭代；当前实现阶段应留出可扩展的结构（类名、占位元素）。

### 参考素材来源（2025-10-24 新增）
- **Iconfont**：现有多套胶卷/胶片图标，适合作为暗盒基础矢量。
- **Figma Community**：搜索“film roll”“film canister”可获得可编辑的矢量组件，包含多态设计或动效示例。
- **Icons8 / Noun Project / IconScout**：提供风格统一的 SVG/PNG，需要留意授权条款。
- **UnDraw / Storyset**：插画风矢量，可拆分提取暗盒或胶片条元素。
- **LottieFiles**：若需要老虎机式随机动效，可搜索“film roll”获取 JSON 动画文件作为参考。
- **Freepik 等矢量站点**：关键词“film roll vector”“film strip vector”获取 EPS/AI，导出 SVG 后可融入项目。

> 建议将选定素材集中存放于 `frontend/src/assets/film/`，并在导入前统一尺寸、拆分层级（盖子/外壳/贴纸等），方便后续编写状态动画。

## 🧱 线框版实现规范（2025-10-24 更新）

在真实视觉稿提供前，页面默认使用简单的线框胶卷样式，统一风格、保持可扩展性：

### 暗盒（FilmCanister）
- 结构由上、下两条黑色盖子（高度约 15%）与中间暗盒长方形组成，维持 1:2 的直立比例。
- 状态映射：
  - `idle`：静止灰色暗盒。
  - `random`：中部区域添加轻微上下浮动（CSS 动画），表示抽选中。
  - `selected`：在暗盒中部叠加淡蓝色半透明块，提示已选中。
- 当前版本不贴品牌/型号文字，只充当结构占位，等待视觉稿就绪后替换。

### 胶片带（FilmStrip）
- 整体为黑色底片矩形，上下各一排矩形齿孔，齿孔数量 = 帧数 + 2。
- 帧窗口为统一宽高比（默认 3:2）的方框，背景黑色，图片以 `<foreignObject>` 嵌入，点击后触发通用预览。
- 片头保留 1 个空框表示未抽出部分；抽出状态下帧窗口沿水平方向展开，保留线框边界便于后期替换真实素材。
- 每帧使用 EXIF Orientation 校正旋转，确保展示时都是横向矩形。

### 布局要点
- 随机模式视图只呈现“左侧暗盒 + 右侧胶片带”，按钮位于暗盒下方，提示文案简短。
- 线框UI要留出合理留白（左右 padding），方便后续替换高保真视觉资源。
- 若需要展示品牌/型号，可在暗盒下方增加一行文字说明，不嵌入图形内部。

> 待视觉稿/矢量素材确定后，再以该线框版为基准替换为正式版本，相关组件接口已预留（`FilmCanister`、`FilmStrip`）。

## 🔗 相关文档

- [随机交互需求澄清记录](./随机交互需求澄清记录.md)
- [随机浏览功能需求澄清记录-详细版](./随机浏览功能需求澄清记录-详细版.md)
- [组件重构-Photos到Gallery](../refactoring-guides/组件重构-Photos到Gallery.md)
- [文档管理规范](./文档管理规范.md)

---

**重要提醒**：这个需求澄清记录体现了用户对真正"胶片暗盒"交互效果的期望，需要实现从胶片暗盒中抽出胶卷的完整交互流程，而不是简单的照片展示。
