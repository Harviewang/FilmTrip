# CMT-20251028-002: 地图中文地点增强（计划）

## 关联需求
- 新需求：为地图/照片上传提供中文省市区街道映射与坐标联动
- 受影响模块：照片上传（PhotoManagement）、照片预览（PhotoPreview）、MapLibre 地图视图、后端照片接口

## 目标与范围
1. **地址解析**：输入中文地点（关键字或坐标）时，自动补全省/市/区/街道并返回坐标；兼容现有 `country/province/city/location_name` 字段
2. **上传/编辑联动**：在上传表单与照片详情编辑时接入地址解析流程，可手动确认或覆盖，并写入数据库
3. **预览小地图**：PhotoPreview 中点击省/市/区字段时，按需加载 MapLibre，展示中文标注与标记（列表视图不加载）

## 任务拆解
| 编号 | 模块 | 任务摘要 | 负责人 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| M-4 | 地图·地址解析 | 国内坐标→5级字段（country/province/city/district/township） | AI助手 | ⏳ 进行中 | 高德API为主，腾讯备用，国外暂缓 |
| M-5 | 地图·上传联动 | 上传/编辑表单地图选点→解析回填地址字段 | AI助手 | ⏳ 待开始 | 仅支持地图选点，不支持文本输入 |
| M-6 | 地图·预览小地图 | PhotoPreview点击省市区触发400×300迷你地图 | AI助手 | ⏳ 待开始 | 复用现有MapLibre，按需加载 |

## 前置准备
- [ ] 清洗现有照片数据的地理信息，统计中文/英文/缺失情况
- [ ] 选型或制作离线中文行政区划数据（省/市/区/街道 + 坐标）
- [ ] 确认后端接口改动范围（新增解析接口或复用原有控制器）

## 验收标准（草案）
- ✅ 上传/编辑时输入中文地点可自动补全省/市/区/街道并生成坐标
- ✅ 预览页点击省/市/区显示迷你地图（中文标注、准确定位）
- ✅ MapLibre 地图根据新的中文字段显示正确信息
- ✅ 旧数据兼容：无省市区/英文地址时给出提示，并支持手动补齐

## 里程碑计划
- **Day 1**：完成数据源选型/准备、接口设计评审（M-4）
- **Day 2-3**：实现上传/编辑联动逻辑并回填历史数据（M-5）
- **Day 4**：完成小地图组件与 E2E 测试，更新文档（M-6）

## 风险与应对
- **行政区划数据量大** → 优先离线缓存常用省市区，提供懒加载或分级查询
- **旧数据格式不统一** → 制定迁移脚本，支持批量补全和人工审核
- **迷你地图性能** → 复用现有 MapLibre 实例或采用懒加载，保证预览性能

---
（待开发完成后补充开发总结、自测结果、审计记录等内容）
