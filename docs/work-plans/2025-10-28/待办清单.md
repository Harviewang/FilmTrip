# CMT-20251028-001 待办清单

> **状态**: ✅ 审计已通过，⏳ 待浏览器实测  
> **最后更新**: 2025-10-28

---

## 审计状态

- ✅ **首轮审计通过**（Codex 2025-10-28）
- ✅ **修正审核通过**（用户反馈修正1、2）
- ✅ **最终审计通过**（所有修正项验证完成）
- ⏳ **待浏览器实测验证**

---

## 待浏览器实测项目

### 1. 地图切换功能测试

**测试步骤**:
1. 启动前端开发服务器
2. 访问地图页面 `http://localhost:5173/map`
3. 点击地图切换按钮 🗺️
4. 观察三轮切换顺序

**期望结果**:
- 第1次点击：切换到 MapTiler 栅格
- 第2次点击：切换到 OSM 栅格
- 第3次点击：切换回 MapTiler 矢量
- ✅ 三轮切换正常工作，没有卡顿

---

### 2. OSM地图加载测试

**测试步骤**:
1. 切换到 OSM 栅格地图
2. 打开浏览器开发者工具 → Network 标签
3. 观察瓦片请求

**期望结果**:
- ✅ 地图正常加载，不白屏
- ✅ 能看到 `.png` 文件请求
- ✅ URL 格式：`https://tile.openstreetmap.org/{z}/{x}/{y}.png`
- ✅ 瓦片正常显示
- ⚠️ 如果遇到 CORS 错误，需要记录并报告

---

### 3. MapTiler栅格PNG瓦片测试

**测试步骤**:
1. 切换到 MapTiler 栅格地图
2. 打开浏览器开发者工具 → Network 标签
3. 观察瓦片请求

**期望结果**:
- ✅ 能看到 `.png` 文件请求
- ✅ URL 格式：`https://api.maptiler.com/maps/dataviz/{z}/{x}/{y}.png?key=xxx`
- ✅ 不再看到 `.pbf` 或 `.mvt` 文件
- ✅ 地图正常加载和显示

---

### 4. 缩放级别限制测试

**测试步骤**:
1. 点击 + 按钮多次，尝试放大
2. 观察显示的最大缩放级别

**期望结果**:
- ✅ 最大只能缩放到 **15x**（显示数字）
- ✅ 不能再继续放大（按钮失效）
- ✅ 三种地图模式都遵循相同的缩放限制
- ✅ 15级是最大缩放级别（显示15x）

---

### 5. 地图功能完整性测试

**测试步骤**:
1. 测试每种地图模式的所有功能：
   - 缩放（+/- 按钮）
   - 拖拽平移
   - 照片标记显示
   - 点击照片标记弹出预览

**期望结果**:
- ✅ 所有地图模式功能正常
- ✅ 照片标记正确显示
- ✅ 点击照片能弹出预览
- ✅ 缩放和平移功能正常

---

## 潜在问题检查

### 问题1: OSM CORS 错误
**现象**: 浏览器控制台出现 CORS 相关错误  
**原因**: OSM 瓦片可能不支持直接跨域访问  
**解决方案**: 
- 使用代理服务器
- 或使用其他免费瓦片服务

### 问题2: 瓦片加载失败
**现象**: 地图显示空白或部分区域空白  
**原因**: 瓦片URL不正确或服务器故障  
**解决方案**: 
- 检查URL格式是否正确
- 检查API密钥是否有效（MapTiler）

### 问题3: 性能问题
**现象**: 地图加载很慢或卡顿  
**原因**: 栅格PNG文件较大  
**解决方案**: 
- 添加缓存机制
- 考虑使用栅格瓦片压缩

---

## 验收标准

### 通过标准
- ✅ 三种地图模式都能正常切换
- ✅ OSM 地图能正常加载（无 CORS 错误）
- ✅ MapTiler 栅格显示 PNG 瓦片（不是 PBF）
- ✅ 最大缩放限制为 15x
- ✅ 所有功能正常工作
- ✅ 没有明显的性能问题

### 不通过标准
- ❌ OSM 地图有 CORS 错误
- ❌ MapTiler 栅格仍显示 PBF 格式
- ❌ 最大缩放超过 15x
- ❌ 地图切换有卡顿或错误
- ❌ 功能不完整或有bug

---

## 测试完成后

### 如果测试通过
1. 填写 Git 提交 hash
2. 标记任务为已完成
3. 归档到已完成的commits

### 如果测试不通过
1. 记录具体问题
2. 分析问题原因
3. 制定修复方案
4. 继续迭代开发

---

## 相关文档

- [提交记录](./commits/CMT-20251028-001.md)
- [工作总结](./summary.md)

