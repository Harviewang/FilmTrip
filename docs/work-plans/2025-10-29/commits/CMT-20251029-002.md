# CMT-20251029-002: M-6预览小地图与城市翻译扩展

## 任务概述
实现照片预览页的迷你地图功能（M-6），扩展城市中文译名映射表（M-7），改进地址解析体验。

## 完成时间
待定（等待 CMT-20251029-001 审计通过后开始）

## 关联任务
- M-6：预览迷你地图
- M-7：城市译名扩展
- 后续可能的：M-8（批量补录）、M-9（location_name 退役）

## 用户需求
1. **预览小地图**：点击地点字段后弹窗显示迷你地图，默认 zoom=12，基于已存坐标落点
2. **城市翻译扩展**：优先补充以下国家的城市中文映射：泰国、菲律宾、新加坡、日本、澳大利亚、韩国
3. **翻译兜底策略**：若 MapTiler 返回英文，使用本地映射或备选服务

## 计划实现内容

### M-6：预览迷你地图（高优先级）

**实现方案**：
1. 在 `PhotoPreview.jsx` 中添加迷你地图弹窗
2. 点击省/市/区字段时触发显示
3. 使用 MapPicker 组件，但尺寸更小（可复用现有组件）
4. 默认 zoom=12，显示地图和标记
5. 使用照片已存储的坐标 (`latitude`, `longitude`)
6. 关闭后释放监听，避免内存泄漏

**组件结构**：
```javascript
<Modal show={showMiniMap} onClose={() => setShowMiniMap(false)}>
  <MapPicker
    onLocationSelect={handleLocationUpdate}
    initialLatitude={photo.latitude}
    initialLongitude={photo.longitude}
    mode="display" // 仅显示模式，不允许编辑
    height="400px"
  />
</Modal>
```

**交互流程**：
1. 用户在预览页看到完整地址（中国广东省深圳市南山区...）
2. 点击地址字段
3. 弹窗显示迷你地图，zoom=12
4. 地图中心为照片坐标
5. 显示红色标记
6. 点击关闭或点击外部关闭弹窗

### M-7：城市译名扩展（中优先级）

**优先国家列表**：
1. 日本 - 主要城市：东京、大阪、京都、奈良、横滨、福冈、札幌等
2. 泰国 - 主要城市：曼谷、清迈、普吉岛、芭提雅等
3. 菲律宾 - 主要城市：马尼拉、宿务、长滩岛等
4. 新加坡 - 行政区划
5. 澳大利亚 - 州和主要城市（部分已有）
6. 韩国 - 主要城市：首尔、釜山、济州岛等

**实现方案**：
在 `backend/routes/geocode-translations.js` 中扩展映射表：
```javascript
// 日本城市
const japanCities = {
  'tokyo': '东京',
  'osaka': '大阪',
  'kyoto': '京都',
  // ...
};

// 泰国城市
const thailandCities = {
  'bangkok': '曼谷',
  'chiang mai': '清迈',
  // ...
};
```

### M-8：批量补录工具（低优先级，待规划）

**设计要点**：
- 管理后台批量选择照片
- 统一坐标选点（多选 → 一次选点 → 所有选中照片更新）
- 复用 MapPicker 组件

### M-9：location_name 字段退役（低优先级，待规划）

**实施方案**：
1. 前端表单已移除 location_name 输入
2. 预览页已使用五级地址拼接显示
3. 后端接口和数据库 schema 需要调整
4. 历史数据迁移策略

## 验收标准

### M-6
- [ ] 预览页点击地点字段弹出迷你地图
- [ ] 迷你地图默认 zoom=12
- [ ] 地图中心为照片坐标
- [ ] 显示红色标记
- [ ] 关闭后释放监听，无内存泄漏
- [ ] 交互流畅，无性能问题

### M-7
- [ ] 日本、泰国、菲律宾、新加坡、韩国城市正确翻译为中文
- [ ] 翻译准确性测试
- [ ] 备选服务兜底策略测试

## 技术债务
- 迷你地图组件可抽象复用
- 翻译映射表维护成本
- 考虑接入第三方翻译 API

## Git 提交
待实现后填写

