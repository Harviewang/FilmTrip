# FilmTrip 协作工作流指引（Codex ↔ AI助手）

> 版本：v2025.10.28-workflow04  
> 适用角色：用户、Codex、AI助手（Windsurf/Claude等）  

本指引约束每日协作，从需求提出到验收关闭均须按流程执行。所有记录以 `docs/work-plans/` 目录为准。

---

## 1. 角色职责
| 角色 | 职责 |
| --- | --- |
| 用户 | 描述需求、确认结果 |
| Codex | 需求澄清与拆解、编写计划、技术审计、验收报告 |
| AI助手* | 按计划实现、提交流水、记录自测与修订 |

*注: AI助手指实际执行开发的AI模型(如Windsurf, Claude等),在文档中应如实填写具体模型名称和运行环境

---

## 2. 协作流程
1. **需求理解**（用户 → Codex）：用户提出需求，Codex 澄清边界。
2. **计划输出**（Codex）：在 `docs/work-plans/YYYY-MM-DD/summary.md` 中写明"需求、任务、验收清单、遗留事项"。
3. **任务执行**（AI助手）：按计划完成代码改动，在任务文件中记录提交与自测。
4. **审计反馈**（Codex）：在任务文件与 summary 中记录"审计结论/复审结论"，勾选验收清单。
5. **修订回归**（AI助手）：根据审计意见修改，并记录修订说明。
6. **验收关闭**（Codex → 用户）：全部检查项完成后，总结当日成果并告知用户；**收到 Codex 正式验收后，由 AI 助手立即执行 `git push`/PR 同步到远端仓库**，并在 summary 中记录提交信息。

流程顺序固定为"用户 → Codex → AI助手 → Codex → 用户"。

**特殊情况**: 如果Codex不可用,AI助手可独立完成全流程,但需在文档中明确说明,并标注待Codex恢复后补充审计。

---

## 3. 目录结构
```
docs/work-plans/
├── README.md                      # 本指引
├── git-log.md                     # 全部提交的 git log 汇总
├── YYYY-MM-DD/                    # 当日目录
│   ├── summary.md                 # 当日概览
│   ├── daily-note.md              # 当日工作日记（可选）
│   └── commits/                   # 当日提交记录（多文件）
│       ├── CMT-YYYYMMDD-001.md    # 提交记录模板
│       └── ...                    # 更多提交
└── ...                            # 历史记录
```

### 3.1 summary.md 必含内容
1. **用户原始需求**：列表描述所有需求及新增意见。  
2. **任务拆解**：表格列出编号/模块/摘要/负责人/状态；引用 `tasks/` 记录。  
3. **验收清单（Codex）**：逐项勾选 `[ ]` 或 `[x]`。  
4. **遗留事项**：未完成、延期或待澄清内容。  
5. （可选）**新增优化项**：记录当日新增任务，须同步任务表。  
6. **审计结论/复审结论**：每次审计记录时间、版本、现状、风险、整改建议。  
7. **当日总结与下一步**：列出完成项、待办、次日计划。  

### 3.2 commits/
- 每个提交单独一个文件，按顺序命名 `CMT-YYYYMMDD-001.md`、`CMT-YYYYMMDD-002.md` …；**上一条提交未获 Codex 验收前不得新建下一条**。模板如下：
  ```
  ## 提交 CMT-YYYYMMDD-001 （PR#/commit，如未生成可留空）
  1. 关联任务：列出编号（如 B-1、C-2）。
  2. 用户意见：本次提交响应的需求或反馈（如无可写“无”）。
  3. 开发总结：改动详情、自测结果、影响范围等（可分点说明）。
  4. 审计记录：按时间列出 Codex 的审计结论（通过/未通过 + 问题）。
  5. 修订历史：若审计未通过，记录每轮修订的时间、内容、负责人。
  6. 验收结果：最终是否通过，注明时间与确认人（仅 Codex 可标记“通过”）。
  7. Git 提交：仅在 Codex 验收通过后填写实际 commit hash / PR 链接；未通过前请留空。
  ```
- `git-log.md`：位于 `docs/work-plans/git-log.md`，保存近期提交摘要，指向相应 `commits` 文档。
- `git-log.md`：保存 `git log` 结果（至少 15 条），方便对照代码历史。**重要：更新时应追加（Append）新记录，不得覆盖（Overwrite）历史记录，保持时间倒序排列。**

> 若一个提交覆盖多个任务，在 summary 表格的对应行都注明状态；审计与修订记录同理。

---

## 4. 提交与记录规范
- PR/Commit 信息需包含 `任务编号`、`摘要`、`自测结果`。例如：`B-2,B-3: 随机多图+API 扩展 (自测: curl + 前端截图)`。
- 在 tasks 文件的“提交记录”中追加条目，并在 summary 表格的状态列更新，例如 `✅ 已完成 - PR#123`。
- 审计结果必须写入对应 tasks 文件，并在 summary 的“验收清单”中勾选或保留未勾选。
- 若审计不通过，Codex 必须注明问题与风险；AI助手修复后记录在"修订记录"，Codex 再复审。
- Codex 标记“验收通过”后，AI 助手需在 30 分钟内完成 `git push`/PR 提交，并在 `summary.md` 与 `git-log.md` 中补充远端信息（commit hash/PR 链接）。

---

## 5. 每日总结
- 工作日结束前，Codex 更新 summary 的“当日总结与下一步”，包括：完成情况、遗留事项、次日计划。  
- 将总结反馈给用户，如有新需求进入新一轮流程。

---

## 6. 固定协作原则
1. **严格按文档执行**：所有沟通与变更须写入 summary/tasks，不得依赖口头记录。  
2. **清晰粒度**：任务文件按模块管理；提交可覆盖多个子任务但需标明引用。  
3. **审计不过不合并**：存在风险的任务不可视为完成。  
4. **文档先于代码**：如有新增任务或流程，先更新 summary 与 tasks，再提交代码。  
5. **历史可追溯**：summary 与 tasks 文件不删除历史记录，必要时用追加方式说明变更。  

> 若要更新指引版本，请先与用户确认，再改动 README 并更新版本号、日期。  

让我们按此流程协作，保持透明、高效、高质量。 🎯
