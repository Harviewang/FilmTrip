# 短链访问帮助（访客 & 运营）

最后更新：2025-11-12

## 1. 快速上手

| 场景 | 操作入口 | 地址栏表现 | 注意事项 |
| --- | --- | --- | --- |
| 浏览 Gallery | `/gallery` 或 `/gallery/random` | 点击照片后自动跳转 `/s/{code}` | 访客勾选“隐藏加密图片”后，列表会立即剔除已知加密项；若网络阻塞可稍等刷新 |
| 浏览 Timeline | `/timeline` | 直接访问 `/timeline/{shortCode}` 或点击卡片 | 关闭预览回退到原时间轴；受保护照片显示锁定提示 |
| 浏览地图 | `/map` 或 `/map?s={code}` | 点击标记后写入 `/s/{code}`；旧 `?photo=` 链接自动回写短链 | 若短链派生自旧链接，关闭时会回到 `/map` |
| 直接分享 | `/s/{code}` | 任何页面复制短链均指向 `/s/{code}` | 短链始终跳转到对应预览浮层；受保护资源会提示“暂不公开” |

## 2. 旧链接兼容

- 仍可访问历史分享链接，如 `/gallery?photo={uuid}`、`/map?photo={uuid}`。  
- 系统检测到旧参数后会立刻替换为 `/s/{code}`，并在地址栏生效。  
- 分享给用户时请更新为短链，以免后续兼容逻辑下线造成访问异常。

## 3. 调试与日志

- 打开浏览器控制台可查看 `window.__shortLinkLogs`（或地图页的 `window.__mapShortLinkLogs`），其中记录了 `openPhotoById`、`updateHistoryForPhoto`、`restoreHistoryPath` 等节点。  
- 回归测试请截取日志片段并附在 `docs/work-plans/2025-11-10/tests/SL-2-shortlink-regression.md`（见下）以通过审计。

## 4. 常见问题

1. **勾选“隐藏加密图片”后列表仍有锁图标？**  
   说明新请求尚未返回或请求失败。刷新页面或稍候即可；若频繁出现，请联系前端查看网络日志。

2. **复制短链后打开空白页？**  
   检查短码长度是否 5 位；被删除或未公开的照片会显示加密提示而非原图。

3. **地图页返回上一页仍是 `/s/{code}`？**  
   请确认浏览器是否阻止 `replaceState`；若复现，请导出 `window.__mapShortLinkLogs` 提交给研发。

## 5. 联系方式

- 产品：`product@filmtrip`  
- 研发支持：`dev@filmtrip`
